function login_nav(e,t){$("#login-form").submit(function(e){e.preventDefault(e);var t=formControls(this);socket.sendMessage("login",t,function(e,a){var o=$("#recordar").is(":checked");o&&localStorage.setItem("srq_lot_srv_login",JSON.stringify(t))})})}function inicio_nav(e,t){var a=copyTo(_helpers);a.ganador=function(e){var t=findBy("elementoID",e,$elementos);return t?"#"+t.numero+" "+t.descripcion:""},$("#btnload").click(function(){function e(){socket.sendMessage("inicio",null,function(e,t){if(t.hasOwnProperty("code"));else{rdia=t.data;for(var o=0;o<rdia.length;o++)rdia[o].jugado,rdia[o].premio,rdia[o].pago;$("#srt_dia").html(jsrender($("#rd-sorteos-dia-row"),t.data,a))}$("#str-dia-stamp").html(t.time)})}$("#inicio-sorteodia").html(jsrender($("#rd-pnlsorteo"),null)),$elementos?e():socket.sendMessage("elementos",null,function(t,a){$elementos=a,e()})})}function sorteoMonitor_nav(e,t){function a(){$(".mnt-historial").click(function(e){e.preventDefault(e);var t=$(this).attr("n"),a={dateDif:function(e){var t=(new Date).format().split("-"),a=new Date(t[0],t[1]-1,t[2]),o=e.split("-"),n=new Date(o[0],o[1]-1,o[2]);return(a.getTime()-n.getTime())/864e5}};socket.sendMessage("sorteo-num-hist",{n:t},function(e,o){var n=findBy("n",t,r.n);$("#md-hnum").html(n.numero+" "+n.desc),$("#md-historia-body").html(jsrender($("#rd-num-row"),o,a)),$("#md-numhist").modal()})}),$(".mnt-vnt-tickets").click(function(e){e.preventDefault(e);var t=$(this).attr("n");socket.sendMessage("sorteo-monitor-vnt",{numero:t,sorteo:s.sorteoID},function(e,a){function n(e,t,a){a=null==a||a;var o,n=[],r=[],s=e.length;for(o=0;o<s;o++)n[e[o][t]]||(n[e[o][t]]=!0,a?r.push(e[o]):r.push(e[o][t]));return r}i=a;var s=n(a,"us"),c=n(a,"bc"),l=n(a,"tq");s.unshift({us:0,usn:"TODAS"}),c.unshift({bc:0,bnc:"TODAS"}),l.unshift({tq:0,tqn:"TODAS"});var u=$("#mnt-ventas-us"),d=$("#mnt-ventas-bc"),f=$("#mnt-ventas-tq");u.html(jsrender($("#rd-us-option"),s)),u.select2("val",0),d.html(jsrender($("#rd-bn-option"),c)),d.select2("val",0),f.html(jsrender($("#rd-tq-option"),l)),f.select2("val",0),$("#md-tickets-body").html(jsrender($("#rd-num-ticket"),a)),o();var m=findBy("n",t,r.n);$("#md-tnum").html(m.numero+" "+m.desc),$("#md-numventas").modal()})})}function o(){$(".fticket").click(function(e){e.preventDefault(e);var t=$("#md-ticket"),a=parseInt($(this).attr("tid"));t.on("shown.bs.modal",function(e){t.off("shown.bs.modal",arguments.callee);var o=$("#md-pagar-ticket");o.val(parseInt(a)),o.focus()}),t.on("hidden.bs.modal",function(e){t.off("hidden.bs.modal",arguments.callee),$("#md-numventas").modal("show")}),$("#md-numventas").modal("hide"),t.modal("show")})}function n(e){socket.sendMessage("sorteos",{lista:e},function(e,a){var o=$("#ssorteos");if(o.html(jsrender($("#rd-sorteo-option"),a)),o.select2("val",""),t&&t.length>1){var n=parseInt(t[1]);o.prop("selectedIndex",n).change(),$("#monitor-form").submit()}})}var r,s,i,c,l=$("#sfecha"),u=new Date;if($("#ord-num-num").click(function(e){e.preventDefault(e),$(".order-num").removeClass("btn btn-primary btn-sm"),$(this).addClass("btn btn-primary btn-sm"),r.n.sort(function(e,t){return e.numero-t.numero}),$("#numeros-body").html(jsrender($("#rd-vtnum-row"),r.n)),a()}),$("#ord-num-jg").click(function(e){e.preventDefault(e),$(".order-num").removeClass("btn btn-primary btn-sm"),$(this).addClass("btn btn-primary btn-sm"),r.n.sort(function(e,t){return t.jugada-e.jugada}),$("#numeros-body").html(jsrender($("#rd-vtnum-row"),r.n)),a()}),l.on("change",function(e){n(e.target.value)}),$("#monitor-form").submit(function(e){var t,o;e.preventDefault(e);var n=_helpers;n.premio=function(e){return(100*e/t).format(2)},n.gana=function(e){return 100*e/t>100},n.pdist=function(e){return(100*e/o).format(2)},s=formControls(this);var i=formLock(this);socket.sendMessage("monitor",s,function(e,s){formLock(i,!1),r=s||[];var c=new Date;$("#ultact").html(c.format("dd/mm/yy hh:MM:ss TT")),t=0,o=0;var l=s.t[0];s.t.forEach(function(e){t+=e.jugada,e.jugada>l.jugada&&(l=e)}),$("#jugada").html(t.format(2)),$("#bnLider").html(l.banca),$("#bnLider-jg").html(l.jugada.format(2)),l=s.n[0],s.n.forEach(function(e){o+=e.tickets,e.pcj=100*e.jugada/t,e.jugada>l.jugada&&(l=e)}),$("#numLider").html(l.desc),$("#numLider-jg").html(l.jugada.format(2)),$("#ventas-body").html(jsrender($("#rd-ventas-row"),s.t)),$("#numeros-body").html(jsrender($("#rd-vtnum-row"),s.n,n)),a()})}),$("#mnt-filtrar-tickets").submit(function(e){e.preventDefault(e);var t=formControls(this);c=i.filter(function(e){return e.us==t.usuario||0==t.usuario}),c=c.filter(function(e){return e.bc==t.banca||0==t.banca}),c=c.filter(function(e){return e.tq==t.taquilla||0==t.taquilla}),$("#md-tickets-body").html(jsrender($("#rd-num-ticket"),c)),o()}),$("#mnt-ticket-smonto").click(function(e){function t(e,t){return 1==a?e.m-t.m:t.m-e.m}e.preventDefault(e);var a=parseInt($(this).attr("ord"));$(this).attr("ord",-1*a),c?(c.sort(t),$("#md-tickets-body").html(jsrender($("#rd-num-ticket"),c))):(i.sort(t),$("#md-tickets-body").html(jsrender($("#rd-num-ticket"),i))),o()}),t&&t.length>0){var d=t[0].split("-");l.datepicker("setDate",new Date(d[0],parseInt(d[1])-1,d[2])),l.trigger("change")}else n(u.format())}function sorteoBuscar_nav(e,t){function a(){var e=$("#buscar-sorteos"),t=uniqueVal(n,"sorteo"),a=[];t.forEach(function(e){a.push(findBy("sorteoID",e.sorteo,$sorteos))}),e.html(jsrender($("#rd-operadora-option"),a)),e.select2("val",""),e.val(""),e.select2("open"),$(".bfiltro").change(function(){e.trigger("change")}),e.change(function(e){function t(){var e=$("#srt-abr").val(),t=$("#srt-prm").val(),r=$("#srt-flt").val(),i=s.filter(function(a){var o,n;return 0==r||(o=1==e?1==a.abierta:0==a.abierta,n=1==t?!!a.g:null==a.g,o&&n)});$("#sorteos-body").html(jsrender($("#rd-sorteo-row"),i,o));var c=$(".ttgl");c.each(function(e){var t=$(this);t.toggles({text:{on:"SI",off:"NO"},on:t.data("activa"),click:!0})}),c.on("toggle",function(e,t){var a={sorteo:$(e.target).data("target"),abierta:t};socket.sendMessage("sorteo-editar",a,function(e,t){console.log(e,t)})}),select2w($(".s3"),{allowClear:!0}),$("select.sorteosel").each(function(e,t){var a=$(t).data("select");$(t).val(a),$(t).select2("val",a)}),$(".sorteosel").change(function(e){var t=e.target.value,o=$(this),r=o.data("sorteo"),s=findBy("elementoID",t,$elementos),i=findBy("sorteoID",r,n),c=confirm("Confirma que desea registrar #"+i.sorteoID+" "+i.descripcion+" #"+s.numero+" "+s.descripcion);if(c){var l={sorteoID:r,elemento:t};a(l,o)}else o.select2("val",o.data("select")),o.val(o.data("select"))})}function a(e,t){socket.sendMessage("sorteo-premiar",e,function(o,n){var r;if(1==n.code)r=findBy("elementoID",e.elemento,$elementos),notificacion("SORTEO PREMIADO","SORTEO #"+e.sorteoID+" PREMIADO<p>GANADOR: #"+r.numero+" "+r.descripcion+"</p>");else if(0==n.code)r=findBy("elementoID",e.elemento,$elementos),notificacion("[JV] SOLICITUD ACEPTADA","SORTEO #"+e.sorteoID+"<p>GANADOR: #"+r.numero+" "+r.descripcion+"</p>");else if(4==n.code){notificacion("SORTEOS","SORTEO #"+e.sorteoID+" YA ESTA PREMIADO","growl-danger");var s=confirm("Este sorteo ya esta premiado, desea reiniciarlo");s?socket.sendMessage("sorteo-reiniciar",{sorteoID:e.sorteoID},function(o,n){notificacion("SORTEOS","SORTEO #"+e.sorteoID+" REINICIADO SATISFACTORIAMENTE"),confirm("DESEA VOLVER A PREMIAR CON EL NUMERO SELECCIONADO?")&&a(e,t)}):(t.select2("val",t.data("select")),t.select2("val",t.data("select")))}else 3==n.code?notificacion("SORTEOS","SORTEO #"+e.sorteoID+" PREMIADO, PERO SIN VENTAS REGISTRADAS","growl-danger"):5==n.code?notificacion("SOLICITUD RECHAZADA"," SORTEO #"+e.sorteoID+" SOLICITUD DUPLICADA","growl-danger"):8==n.code&&notificacion("SOLICITUD RECHAZADA"," SORTEO #"+e.sorteoID+" SORTEO ABIERTO","growl-danger")})}var r=e.target.value,s=exploreBy("sorteo",r,n),i=findBy("sorteo",r,$elementos);i?t():socket.sendMessage("elementos",{sorteo:r},function(e,a){$elementos=$elementos.concat(a),t()})})}var o={padding:padding,sorteos:function(e){for(var t="",a=exploreBy("sorteo",e,$elementos),o=0;o<a.length;o++)t+='<option value="'+a[o].elementoID+'">#'+a[o].numero+" "+a[o].descripcion+"</option>";return t}},n=[],r=$(".tgl");r.each(function(e){var t=$(this);t.toggles({text:{on:"SI",off:"NO"},on:t.data("activo"),click:!0})}),r.on("toggle",function(e,t){a()}),$("#sorteo-buscar").submit(function(e){e.preventDefault(e);var t=formControls(this),o=formLock(this);socket.sendMessage("sorteos",t,function(e,t){formLock(o,!1),n=t||[],a()})})}function sorteoNuevo_nav(e,t){function a(){var e=parseInt(n.val()),t=o.filter(function(t){return t.sorteo==e});$("#presorteo-body").html(jsrender($("#rd-presorteo-row"),t)),$(".sorteo-rem").click(function(e){e.preventDefault(e);var a=parseInt($(this).attr("sorteo"));socket.sendMessage("presorteo-remover",{sorteoID:a},function(e,o){var n=findIndex("sorteoID",a,t);t.splice(n,1),$("#prs-"+a).remove()})})}var o,n=$("#sorteos");getScript("../theme/js/bootstrap-timepicker.min.js",function(){$(".time").timepicker()}),n.change(function(){a()}),socket.sendMessage("lsorteos",null,function(e,t){n.html(jsrender($("#rd-sorteo"),t)),socket.sendMessage("presorteos",null,function(e,t){o=t||[],n.select2("val",""),a()})}),$("#presorteo-nuevo").submit(function(e){e.preventDefault(e);var t=formControls(this);delete t.hour,delete t.minute,delete t.meridian,socket.sendMessage("presorteo-nuevo",t,function(e,n){t.sorteoID=n,o.push(t),a()})}),$("#remsorteo").click(function(e){e.preventDefault(e);var t=$("#sorteos").select2("val"),a=findBy("sorteoID",t,$sorteos),o=confirm("Seguro desea eliminar el sorteo "+a.nombre);o&&socket.sendMessage("sorteo-remover",{sID:t},function(e,t){"1"==t&&notificacion("Sorteo "+a.nombre+" eliminado...","","growl-success")})})}function sorteoRegistrar_nav(e,t){var a,o=$("#desde"),n=$("#hasta");$sorteos&&$sorteos.length>0?$("#sorteos").html(jsrender($("#rd-lsorteo-option"),$sorteos)):socket.sendMessage("lsorteos",null,function(e,t){$sorteos=t,$("#sorteos").html(jsrender($("#rd-lsorteo-option"),$sorteos))}),$("#sorteo-registrar").submit(function(e){function t(e,o){notificacion("SORTEO(S) REGISTRADO(S)","<p>Fecha: "+r.fecha+"</p><p>"+o.length+" sorteos registrados</p>");var i=n.val();r.fecha<i?(a.setDate(a.getDate()+1),r.fecha=a.format("yyyy-mm-dd"),setTimeout(function(){socket.sendMessage("sorteo-registrar",r)},500)):(socket.removeListener("sorteo-registrar",t),formLock(s,!1))}e.preventDefault(e);var r=formControls(this),s=formLock(this);r.fecha=o.val();var i=o.val().split("-");a=new Date(i[0],i[1]-1,i[2]),socket.addListener("sorteo-registrar",t),socket.sendMessage("sorteo-registrar",r)})}function sorteoFrutas_nav(e,t){function a(){o=r.val(),socket.sendMessage("elementos",{msorteo:o},function(e,t){n=t,$("#elementos-body").html(jsrender($("#elemento-row"),t))})}var o,n,r=$("#sorteos");$sorteos&&sorteos.length>0?$("#sorteos").html(jsrender($("#rd-sorteo"),$sorteos)):socket.sendMessage("lsorteos",null,function(e,t){$sorteos=t,$("#sorteos").html(jsrender($("#rd-sorteo"),$sorteos)),r.select2("val","")}),r.change(function(){a()}),$("#elemento-form").submit(function(e){e.preventDefault(e);var t=formControls(this);socket.sendMessage("elemento-nuevo",t,function(e,o){$("#descripcion").val("");var n=$("#numero");n.val(""),n.focus(),t.elementoID=o,$elementos.push(t),a()})}),$("#fzodiaco").submit(function(e){e.preventDefault(e);for(var t=formControls(this),a=["CP","AC","PI","AR","TA","GE","CN","LE","VI","LI","ES","SA"],r=[],s=0;s<n.length;s++)for(var i=0;i<a.length;i++)r.push({numero:n[s].numero+a[i],descripcion:n[s].descripcion+"-"+a[i]});socket.sendMessage("elemento-nuevo-zodiaco",{sorteo:o,numeros:r,adicional:t.adicional},function(e,t){notificacion("SORTEO ZODIACALIZADO")})})}function sorteoPremiar_nav(){function e(e){socket.sendMessage("sorteos",{lista:e},function(e,t){a=t||[];var o=$("#premiar-sorteo");o.html(jsrender(r,a)),o.select2("val",""),o=$("#reiniciar-sorteo"),o.html(jsrender(r,a)),o.select2("val","")})}function t(e){var t=findBy("sorteoID",e,a);n.html(jsrender(s,exploreBy("sorteo",t.sorteo,$elementos)))}var a,o=$("#premiar-sorteo"),n=$("#premiar-numero"),r=$("#rd-sorteo-option"),s=$("#rd-elemento-option");$(".date").on("change",function(t){e(t.target.value)}),o.on("change",function(){t(o.val())}),$("#premiar-form").submit(function(e){e.preventDefault(e);var t=formControls(this),a=formLock(this);socket.sendMessage("sorteo-premiar",t,function(e,o){var n;formLock(a,!1),1==o.code?(n=findBy("elementoID",t.elemento,$elementos),notificacion("SORTEO PREMIADO","SORTEO #"+t.sorteoID+" PREMIADO<p>GANADOR: #"+n.numero+" "+n.descripcion+"</p>")):0==o.code?(n=findBy("elementoID",t.elemento,$elementos),notificacion("[JV] SOLICITUD ACEPTADA","SORTEO #"+t.sorteoID+"<p>GANADOR: #"+n.numero+" "+n.descripcion+"</p>")):4==o.code?notificacion("SORTEOS","SORTEO #"+t.sorteoID+" YA ESTA PREMIADO","growl-danger"):3==o.code?notificacion("SORTEOS","SORTEO #"+t.sorteoID+" PREMIADO, PERO SIN VENTAS REGISTRADAS","growl-danger"):5==o.code?notificacion("SOLICITUD RECHAZADA"," SORTEO #"+t.sorteoID+" SOLICITUD DUPLICADA","growl-danger"):8==o.code&&notificacion("SOLICITUD RECHAZADA"," SORTEO #"+t.sorteoID+" SORTEO ABIERTO","growl-danger")})}),$("#reiniciar-form").submit(function(e){e.preventDefault(e);var t=confirm("Seguro desea reiniciar premio?");if(t){var a=formControls(this),o=formLock(this);socket.sendMessage("sorteo-reiniciar",a,function(e,t){formLock(o,!1),t.hasOwnProperty("code")?notificacion("SERVIDOR OCUPADO","INTENTE NUEVAMENTE"):notificacion("SORTEOS","SORTEO #"+a.sorteoID+" REINICIADO SATISFACTORIAMENTE")})}});var i=(new Date).format();e(i)}function bancasUsuarios_nav(){function e(){$usuarios.sort(function(e,t){return t.activo-e.activo?1:-1}),$("#usuarios-body").html(jsrender($("#rd-usuario-row"),$usuarios));var t=$("#us-cmbn");t.on("change",function(){e()}),t.is(":checked")?($(".us-bn").addClass("hidden"),$(".us-cm").removeClass("hidden")):($(".us-bn").removeClass("hidden"),$(".us-cm").addClass("hidden"));var a=$(".clave");a.on("mouseover",function(){var e=parseInt($(this).attr("uid"));$(this).html(findBy("usuarioID",e,$usuarios).clave)}),a.on("mouseout",function(){$(this).html("***")});var o=$(".toggle");o.each(function(e){var t=$(this);t.toggles({text:{on:"SI",off:"NO"},on:t.data("activo"),click:!0})}),$(".btgl").on("toggle",function(e,t){var a=$(e.target).data("target"),o=findBy("usuarioID",a,$usuarios);t=1==t?3:t,socket.sendMessage("usuario-editar",{usuarioID:o.usuarioID,activo:t},function(e,a){1==a.code?o.activo=t:alert("ERROR AL ACTIVAR/DESACTIVAR USUARIO")})})}$usuarios?e():socket.sendMessage("usuarios",null,function(t,a){$usuarios=a||[],e()}),$("#usuario-nuevo").submit(function(t){t.preventDefault(t);var a=$("#psw-grupo");a.removeClass("has-error");var o=formControls(this);o.comision=0,o.participacion=0,o.renta=0;var n=formLock(this);socket.sendMessage("usuario-nuevo",o,function(t,a){formReset(n),a>0?(o.usuarioID=a,$usuarios.push(o),e(),notificacion("USUARIO NUEVO","Usuario registrado exitosamente","growl-success")):notificacion("USUARIO DUPLICADO","Imposible registrar usuario, ya existe","growl-danger")})})}function bancasUsuario_nav(e,t){function a(){$("#bancas-body").html(jsrender($("#rd-banca-row"),n));var e=$(".password");e.on("mouseover",function(e){$(e.target).html($(e.target).data("clave"))}),e.on("mouseout",function(e){$(e.target).html("***")});var t=$(".toggle");t.each(function(e){var t=$(this);t.toggles({text:{on:"SI",off:"NO"},on:t.data("activa"),click:!0})}),$(".btgl").on("toggle",function(e,t){var a=$(e.target).data("target"),o=findBy("bancaID",a,n);socket.sendMessage("banca-editar",{bancaID:o.bancaID,activa:t},function(e,a){1==a?o.activa=t:alert("ERROR AL MODIFICAR ESTADO ACTIVO DE BANCA")})})}var o,n;$("#usuario-editar").submit(function(e){e.preventDefault(e);var t=formControls(this);t.usuarioID=o.usuarioID;var a=formLock(this);socket.sendMessage("usuario-editar",t,function(e,t){formLock(a,!1),console.log(e,t)})}),t&&1==t.length?(socket.sendMessage("usuarios",{id:t[0]},function(e,t){o=t[0],formSet($("#usuario-editar"),o),socket.sendMessage("bancas",{usuario:o.usuarioID},function(e,t){n=t||[],a()})}),$("#banca-nueva").submit(function(e){e.preventDefault(e);var t=formControls(this);t.usuarioID=o.usuarioID,t.renta=t.renta/100;var r=formLock(this);socket.sendMessage("banca-nueva",t,function(e,o){formLock(r,!1),o>0?(formReset(r),t.bancaID=o,n.push(t),a(),notificacion("BANCA NUEVA","Banca registrada exitosamente")):notificacion("ERROR","Banca no registrada, usuario duplicado","growl-danger")})})):nav.nav("406")}function bancasSuspender_nav(e,t){function a(){socket.sendMessage("usuarios",{comercial:r.val()},function(e,t){i.html(jsrender($("#rd-usuario-option"),t)),i.select2("val","")})}function o(){socket.sendMessage("usuario-listaSuspender",null,function(e,t){t=t||[],t.sort(function(e,t){return e.c<t.c?-1:e.c>t.c?1:0}),n=t,s.html(jsrender($("#rd-cond-row"),t)),$(".sprem").click(function(e){e.preventDefault(e);var t=$(this).attr("usID"),a=confirm("SEGURO DESEA REMOVER ESTA CONDICION?");a&&socket.sendMessage("usuario-susprem",{sID:t},function(e,a){findBy("sID",t,n);$("#r"+t).remove()})}),socket.sendMessage("comerciales",null,function(e,t){r.html(jsrender($("#rd-usuario-option"),t)),r.select2("val",""),i.select2("val","")})})}var n=[],r=$("#sup-comer"),s=$("#cond-body"),i=$("#sup-banca");r.change(function(){i.html(""),l&&a()});var c=$("#nivel2"),l=!1;c.click(function(){l=$(this).is(":checked"),$(".nivel2").toggleClass("hidden"),l&&a()}),$("#suspnvo-form").submit(function(e){e.preventDefault(e);var t=formControls(this);l?(t.sID="u"+t.bID,delete t.bID):t.sID="c"+t.sID;var a=formLock(this);socket.sendMessage("usuario-suspnvo",t,function(e,t){formLock(a,!1),s.html(""),o()})}),o()}function bancasComercial_nav(e,t){function a(){$("#bancas-body").html(jsrender($("#rd-banca-row"),n));var e=$(".password");e.on("mouseover",function(e){$(e.target).html($(e.target).data("clave"))}),e.on("mouseout",function(e){$(e.target).html("***")});var t=$(".toggle");t.each(function(e){var t=$(this);t.toggles({text:{on:"SI",off:"NO"},on:t.data("activa"),click:!0})}),$(".btgl").on("toggle",function(e,t){var a=$(e.target).data("target"),o=findBy("usuarioID",a,n);t=1==t?3:t,socket.sendMessage("usuario-editar",{usuarioID:o.usuarioID,activo:t},function(e,a){1==a.code?(notificacion("ACT/DESC COMPLETADA CON EXITO"),o.activo=t):alert("ERROR AL MODIFICAR ESTADO ACTIVO DE BANCA")})})}var o,n,r=$("#usuarios");if($("#usuario-editar").submit(function(e){e.preventDefault(e);var t=formControls(this);t.usuarioID=o.usuarioID,t.renta=t.renta/100,t.participacion=t.participacion/100,t.comision=t.comision/100,$("#alquiler").is(":checked")&&(t.comision=-1*t.comision);var a=formLock(this);socket.sendMessage("usuario-editar",t,function(e,o){formLock(a,!1);var n=findBy("usuarioID",t.usuarioID,$usuarios);n.renta=t.renta,notificacion("EDICION EXITOSA")})}),t&&1==t.length){function s(){var e=$usuarios.filter(function(e){return e.activo>0});e=e.sort(function(e,t){return e.nombre<t.nombre?-1:1}),r.html(jsrender($("#rd-usuario-option"),e)),r.select2("val",0)}socket.sendMessage("usuarios",{id:t[0]},function(e,t){o=t[0],formSet($("#usuario-editar"),o,function(e,t){return"comision"==t||"participacion"==t||"renta"==t?Math.abs(100*e):!1===e?0:!0===e?1:e}),o.comision<0&&$("#alquiler").prop("checked",1),socket.sendMessage("usuarios",{comercial:o.usuarioID},function(e,t){n=t||[],a(),$usuarios?s():socket.sendMessage("usuarios",null,function(e,t){$usuarios=t||[],s()})})}),$("#banca-nueva").submit(function(e){e.preventDefault(e);var t=formControls(this);t.comision=t.comision/100,t.participacion=t.participacion/100,t.tipo=1,t.renta=0,t.cid=o.usuarioID;var r=formLock(this);socket.sendMessage("usuario-nuevo",t,function(e,o){o>0?(formReset(r),t.usuarioID=o,n.push(t),a(),notificacion("BANCA NUEVA","Banca registrada exitosamente")):(formLock(r,!1),notificacion("ERROR","Banca no registrada, usuario duplicado","growl-danger"))})}),$("#banca-asignar").submit(function(e){e.preventDefault(e);var t=formControls(this);t.cid=o.usuarioID;var r=formLock(this);socket.sendMessage("usuario-asignar",t,function(e,t){formLock(r,!1),t>0?(notificacion("ASIGNACION EXITOSA"),socket.sendMessage("usuarios",{comercial:o.usuarioID},function(e,t){n=t||[],a()})):notificacion("ASIGNACION FALLIDA")})})}else nav.nav("406")}function bancasBanca_nav(e,t){if(t&&1==t.length){var a,o,n=$("#banca-nueva"),r=$("#grupo-nuevo"),s=$("#banca-psw"),i=$("#papelera");function c(){var e=i.prop("checked");o.sort(function(e,t){return e.papelera<t.papelera?-1:e.papelera>t.papelera?1:e.activa<t.activa?1:e.activa>t.activa?-1:e.taquillaID-t.taquillaID}),$("#grupos-body").html(jsrender($("#rd-grupo-row"),o.filter(function(t){return e==t.papelera})));var t=$(".password");t.on("mouseover",function(e){$(e.target).html($(e.target).data("clave"))}),t.on("mouseout",function(e){$(e.target).html("***")});var a=$(".toggle");a.each(function(e){var t=$(this);t.toggles({text:{on:"SI",off:"NO"},on:t.data("activa"),click:!0})}),$(".btgl").on("toggle",function(e,t){var a=$(e.target).data("target"),n=findBy("bancaID",a,o);socket.sendMessage("banca-editar",{bancaID:n.bancaID,activa:t},function(e,t){1==t?notificacion("CAMBIO ACTIVO EXITOSO"):alert("ERROR AL MODIFICAR ESTADO ACTIVO DE BANCA")})}),$(".bn-remove-req").click(function(e){e.preventDefault(e);var t=$(this).attr("bancaID"),a=confirm("Seguro desea eliminar esta banca? Tenga en cuenta que enviara a la papelera todas las taquillas asociadas.");return!0===a&&socket.sendMessage("banca-remover",{bancaID:t,papelera:1},function(e,a){if(1==a.code){var n=findBy("bancaID",t,o);n.papelera=1,c()}}),!1}),$(".bn-remove-res").click(function(e){e.preventDefault(e);var t=$(this).attr("bancaID"),a=confirm("Seguro desea restaurar esta banca?  Tenga en cuenta que restaurara todas las taquillas asociadas.");return!0===a&&socket.sendMessage("banca-remover",{bancaID:t,papelera:0},function(e,a){if(1==a.code){var n=findBy("bancaID",t,o);n.papelera=0,c()}}),!1})}i.change(function(){c()}),r.submit(function(e){e.preventDefault(),notificacion("En construccion")}),n.submit(function(e){e.preventDefault(e);var t=formControls(this);t.usuarioID=a.usuarioID,t.renta=t.renta/100,t.comision=t.comision/100,t.participacion=t.participacion/100,formLock(this),socket.sendMessage("usuario-editar",t,function(e,t){formLock(n[0],!1),1==t.code?(notificacion("Cambios guardados con exito"),t.hasOwnProperty("activa")&&(a.activa=t.activa),t.hasOwnProperty("nombre")&&(a.nombre=t.nombre),t.hasOwnProperty("comision")&&(a.comision=t.comision),t.hasOwnProperty("usuario")&&(a.usuario=t.usuario)):notificacion("Error al realizar cambios","","growl-danger")})}),s.submit(function(e){e.preventDefault(e),formLock(this);var t=formControls(this);t.bancaID=a.bancaID,socket.sendMessage("banca-editar",t,function(e,t){formReset(s[0]),1==t.code?(notificacion("Cambio de clave exitoso"),t.hasOwnProperty("clave")&&(a.clave=t.clave)):notificacion("Cambio de clave fallido","","growl-danger")})}),$(".rdo-com").change(function(){multiplo=this.value,$("#gr-comision").prop("disabled",0==this.value)}),socket.sendMessage("usuarios",{id:t[0]},function(e,t){a=t[0]||null,formSet(n,a,function(e,t){return"comision"==t||"participacion"==t||"renta"==t?Math.abs(100*e):!1===e?0:!0===e?1:e}),socket.sendMessage("bancas",{usuario:a.usuarioID},function(e,t){o=t||[],c()})})}else nav.nav("406")}function bancasTaquillas_nav(e,t){if(t&&1==t.length){var a,o,n=$("#banca-nueva"),r=$("#banca-psw"),s=$("#banca-renta"),i=0,c=$("#papelera");function l(){function e(){var t=c.prop("checked");o.sort(function(e,t){return e.papelera<t.papelera?-1:e.papelera>t.papelera?1:e.activa<t.activa?1:e.activa>t.activa?-1:e.taquillaID-t.taquillaID}),$("#taquillas-body").html(jsrender($("#rd-taquilla-row"),o.filter(function(e){return t==e.papelera})));var a=$(".password");a.on("mouseover",function(e){$(e.target).html($(e.target).data("clave"))}),a.on("mouseout",function(e){$(e.target).html("***")});var n=$(".activart");n.each(function(e){var t=$(this);t.toggles({text:{on:"SI",off:"NO"},on:t.data("activa"),click:1})}),n.on("toggle",function(e,t){var a=$(e.target).data("target"),n=findBy("taquillaID",a,o);socket.sendMessage("taquilla-editar",{taquillaID:n.taquillaID,activa:t},function(e,a){1===a?n.activa=t:alert("ERROR AL MODIFICAR ESTADO ACTIVO DE TAQUILLA")})});var r=$(".fingerlock");r.each(function(e){var t=$(this);t.toggles({text:{on:"SI",off:"NO"},on:t.data("activa"),click:!0})}),r.on("toggle",function(e,t){var a=$(e.target).data("target"),n=findBy("taquillaID",a,o);socket.sendMessage("taquilla-flock",{taquillaID:n.taquillaID,activa:t},function(e,a){1===a?n.fingerlock=t:alert("ERROR AL MODIFICAR VALIDACION DE HUELLA")})}),$(".fingerclear").click(function(e){e.preventDefault(e);var t=$(e.currentTarget),a=parseInt(t.attr("val"));socket.sendMessage("taquilla-fpclear",{taquillaID:a},function(e,a){1===a?t.parent().html('<i class="fa fa-shield"></i>'):alert("ERROR AL MODIFICAR HUELLA DEL TAQUILLA")})}),$(".bn-remove-req").click(function(t){t.preventDefault(t);var a=$(this).attr("taqID"),n=confirm("Seguro desea eliminar esta taquilla?");return!0===n&&socket.sendMessage("taquilla-remover",{taquillaID:a,papelera:1},function(t,n){if(1==n.code){var r=findBy("taquillaID",a,o);r.papelera=1,e()}}),!1}),$(".bn-remove-res").click(function(t){t.preventDefault(t);var a=$(this).attr("taqID");return socket.sendMessage("taquilla-remover",{taquillaID:a,papelera:0},function(t,n){if(1==n.code){var r=findBy("taquillaID",a,o);r.papelera=0,e()}}),!1})}formSet(n,a,function(e,t){return"comision"==t?Math.abs(100*e):!1===e?0:!0===e?1:e}),0==a.comision?$("#radioNormal").prop("checked",!0):a.comision>0?$("#radioRecogedor").trigger("click"):a.comision<0&&$("#radioReventa").trigger("click"),$("#taquilla-nueva").submit(function(t){t.preventDefault(t);var n=formControls(this);n.bancaID=a.bancaID,n.usuarioID=a.usuarioID;var r=formLock(this);socket.sendMessage("taquilla-nueva",n,function(t,a){a.hasOwnProperty("code")?(formLock(r,!1),notificacion("DISCULPE: USUARIO NO DISPONIBLE","El usuario que esta asignando a la taquilla, ya esta en uso intente con uno distinto.","growl-danger")):(formReset(r),n.taquillaID=a,n.papelera=0,n.fingerlock=!0,n.fingerprint=null,o.push(n),e(),notificacion("TAQUILLA REGISTRADA CON EXITO"))})}),socket.sendMessage("taquillas",{banca:a.bancaID},function(t,a){o=a||[],e()});var t=$("#rem-taqinactivas");t.click(function(){function a(c){i.html(n+"/"+r.length),socket.sendMessage("taquilla-remover",{taquillaID:c,papelera:1},function(l,u){1==u.code&&(s=findBy("taquillaID",c,o),s.papelera=1,++n<r.length?a(r[n].taquillaID):(e(),i.html(""),t.prop("disabled",0)))})}var n=0,r=o.exploreBy("activa",0).exploreBy("papelera",0);if(0!=r.length){t.prop("disabled",1);var s,i=$("#rem-tqinc"),c=confirm("Confirma desea remover todas las taquillas inactivas?");!0===c&&a(r[n].taquillaID)}})}c.change(function(){updateTaquillas()}),n.submit(function(e){e.preventDefault(e);var t=formControls(this);t.bancaID=a.bancaID,t.comision=t.comision*i,formLock(this),socket.sendMessage("banca-editar",t,function(e,t){formLock(n[0],!1),1==t.code?(notificacion("Cambios guardados con exito"),t.hasOwnProperty("activa")&&(a.activa=t.activa),t.hasOwnProperty("nombre")&&(a.nombre=t.nombre),t.hasOwnProperty("comision")&&(a.comision=t.comision),t.hasOwnProperty("usuario")&&(a.usuario=t.usuario)):notificacion("Error al realizar cambios","","growl-danger")})}),s.submit(function(e){e.preventDefault(e);var t=formControls(this);t.bancaID=a.bancaID,t.renta=t.renta/100,formLock(this),socket.sendMessage("banca-editar",t,function(e,t){formLock(s[0],!1),1==t?notificacion("Cambios guardados con exito"):notificacion("Error al realizar cambios","","growl-danger")})}),r.submit(function(e){e.preventDefault(e),formLock(this);var t=formControls(this);t.bancaID=a.bancaID,socket.sendMessage("banca-editar",t,function(e,t){formReset(r[0]),1==t.code?(notificacion("Cambio de clave exitoso"),t.hasOwnProperty("clave")&&(a.clave=t.clave)):notificacion("Cambio de clave fallido","","growl-danger")})}),$(".rdo-com").change(function(){i=this.value,$("#bn-comision").prop("disabled",0==this.value)}),a=findBy("bancaID",t[0],$bancas),a?l():socket.sendMessage("bancas",{id:t[0]},function(e,t){$bancas.push(t[0]),a=t[0],l()})}else nav.nav("406")}function bancasTaquilla_nav(e,t){var a;t&&1==t.length?(socket.sendMessage("taquillas",{id:t[0]},function(e,t){a=t[0],formSet($("#taquilla-nueva"),a)}),$("#taquilla-nueva").submit(function(e){e.preventDefault(e);var t=formControls(this);t.taquillaID=a.taquillaID;var o=formLock(this);socket.sendMessage("taquilla-editar",t,function(e,t){formLock(o,!1),t.hasOwnProperty("code")?notificacion("DISCULPE: USUARIO NO DISPONIBLE","","growl-danger"):notificacion("TAQUILLA","CAMBIOS REALIZADOS EXITOSAMENTE","growl-success")})}),$("#cambiar-clave").submit(function(e){e.preventDefault(e);var t=formControls(this);t.taquillaID=a.taquillaID;var o=formLock(this);socket.sendMessage("taquilla-editar",t,function(e,t){formReset(o)})})):nav.nav("406")}function bancasTopes_nav(e,t){var a,o={elm:function(e){if(0==e)return"TODAS";var t=findBy("elementoID",e,$elementos);return t?t.descripcion:""},srt:function(e){return 0==e?"TODOS":'<a href="#sorteo|'+e+'">#'+padding(e,5)+"</a>"}},n=$("#taquilla"),r=$(".s2banca");a=$bancas.slice(),a.unshift({bancaID:0,nombre:"TODAS"}),r.html(jsrender($("#rd-banca-option"),a)),a=$elementos.slice(),a.unshift({elementoID:0,descripcion:"TODAS"}),$("#elemento").html(jsrender($("#rd-elemento-option"),a));var s=$("#banca");s.change(function(){var e=$(this).val();socket.sendMessage("taquillas",{banca:e},function(e,t){t=t||[],t.unshift({taquillaID:0,nombre:"TODAS"}),n.html(jsrender($("#rd-taquilla-option"),t)),n.select2("val",0)})}),s.trigger("change"),$("#topes-form").submit(function(e){e.preventDefault(e);var t=formControls(this),a=formLock(this);socket.sendMessage("topes",t,function(e,t){formLock(a,!1),$("#topes-body").html(jsrender($("#rd-topes-row"),t||[],o))})}),$("#tope-nuevo").submit(function(e){e.preventDefault(e);var t=formControls(this);console.log(t);var a=formLock(this);socket.sendMessage("tope-nuevo",t,function(e,t){formLock(a,!1),console.log(e,t)})})}function reporteGeneral_nav(e,t){var a,o=$("#reporte-fecha1"),n=$("#reporte-fecha2"),r=$("#reporte");if(_helpers.rgFiltro=function(){return o.val()&&n.val()?"|"+o.val()+"|"+n.val():""},r.submit(function(e){e.preventDefault(e);var t=formControls(this),o=formLock(this),n=$("#rp-agrupar").val();socket.sendMessage("reporte-general",{s:t,g:n},function(e,t){if(formLock(o,!1),!t)return $("#reporte-body").html(""),void $(".clr").html("--");a=t;var n,r,s=0,i=0,c=0;t.forEach(function(e){e.balance=e.jugada-e.premio,s+=e.jugada,i+=e.premio,c+=e.renta,e.balance*e.participacion}),$("#mnt-jugado").html(s.format(2)),$("#mnt-premios").html(i.format(2)),n=t.slice(),n.sort(function(e,t){return t.renta-e.renta}),r=n[0],$("#tj-banca").html(r.desc),$("#tj-jugada").html(r.jugada.format(2)),$("#renta").html(c.format(2)),$("#reporte-body").html(jsrender($("#rd-reporte"),t))})}),$("#rtp-desc-o").click(function(e){e.preventDefault(e),a.sort(function(e,t){var a=0;return e=e.desc.toLowerCase(),t=t.desc.toLowerCase(),e>t&&(a=1),e<t&&(a=-1),a}),$("#reporte-body").html(jsrender($("#rd-reporte"),a))}),t&&t.length>0){var s=t[0].split("-"),i=t[1].split("-");o.datepicker("setDate",new Date(s[0],parseInt(s[1])-1,s[2])),n.datepicker("setDate",new Date(i[0],parseInt(i[1])-1,i[2])),r.trigger("submit")}}function reporteComercial_nav(e,t){function a(){if(0!=r.length){var e=0,t=0,a=0,n=0,s=0,l=0;r.forEach(function(a){a.balance=a.jg-a.pr-a.cm-a.prt,a.rango=i[0].value+"|"+c[0].value,l+=a.balance,e+=a.jg,t+=a.pr,n+=a.cm,s+=a.rt});var u,d,f={j:e.format(2),pr:t.format(2),b:(l-s).format(2),cm:n.format(2),r:s.format(2)};$("#bheader").html(jsrender($("#rd-total"),f)),$("#mnt-jugado").html(e.format(2)),$("#mnt-premios").html(t.format(2)),$("#mnt-pagos").html(a.format(2)),$("#mnt-balance").html((l-s).format(2)),
$("#tg-descuento").html((n+s).format(2)),$("#tg-comision").html(n.format(2)),$("#tg-renta").html(s.format(2)),u=r.slice(),u.sort(function(e,t){return t.jg-e.jg}),d=u[0],$("#tj-banca").html(d.desc),$("#tj-jugada").html(d.jg.format(2)),$("#tj-balance").html(d.balance.format(2)),u=r.slice(),u.sort(function(e,t){return t.balance-e.balance}),d=u[0],$("#tg-banca").html(d.desc),$("#tg-jugada").html(d.jg.format(2)),$("#tg-balance").html(d.balance.format(2)),$("#reporte-body").html(jsrender($("#rd-reporte"),r)),o()}}function o(){var e=document.getElementById("exportar");e.href="#reporte/general";var t=t="SRQ - REPORTE "+n.inicio+"-"+n.fin+"."+m.val();"json"==m.val()?download("exportar",JSON.stringify(r,null,2),t,"text/plain"):"csv"==m.val()?notificacion("FORMATO NO DISPONIBLE"):html2canvas($("#print-img"),{onrendered:function(a){var o=a.toDataURL("image/png");e.href=o,e.download=t}})}var n,r,s=t[0],i=$("#reporte-fecha1"),c=$("#reporte-fecha2"),l=$("#reporte"),u=$("#prm-select"),d=$("#rp-agrupar"),f={bn:function(){return $usuario.nombre}};$("#reporte").submit(function(e){e.preventDefault(e),n=formControls(this);var t=formLock(this);$("#pheader").html(jsrender($("#rd-prtaq"),n,f)),n.comercial=s,socket.sendMessage("reporte-comercial",{s:n,g:d.val()},function(e,o){formLock(t,!1),r=o||[],a()})}),u.change(a);var m=$("#formato");if(m.change(o),t&&t.length>1){var p=t[1].split("-"),v=t[2].split("-");i.datepicker("setDate",new Date(p[0],parseInt(p[1])-1,p[2])),c.datepicker("setDate",new Date(v[0],parseInt(v[1])-1,v[2])),l.trigger("submit")}}function reporteBanca_nav(e,t){function o(){if(0!=s.length){var e=0,t=0,a=0,o=0,r=0,l=0;s.forEach(function(a){a.balance=a.jg-a.pr-(a.cm||a.cmt)-a.prt,a.rango=i[0].value+"|"+c[0].value,l+=a.balance,e+=a.jg,t+=a.pr,o+=a.cm||a.cmt,r+=a.rt});var u,d,f={j:e.format(2),pr:t.format(2),b:(l-r).format(2),cm:o.format(2),r:r.format(2)};$("#bheader").html(jsrender($("#rd-total"),f)),$("#mnt-jugado").html(e.format(2)),$("#mnt-premios").html(t.format(2)),$("#mnt-pagos").html(a.format(2)),$("#mnt-balance").html((l-r).format(2)),$("#tg-descuento").html((o+r).format(2)),$("#tg-comision").html(o.format(2)),$("#tg-renta").html(r.format(2)),u=s.slice(),u.sort(function(e,t){return t.jg-e.jg}),d=u[0],$("#tj-banca").html(d.desc),$("#tj-jugada").html(d.jg.format(2)),$("#tj-balance").html(d.balance.format(2)),u=s.slice(),u.sort(function(e,t){return t.balance-e.balance}),d=u[0],$("#tg-banca").html(d.desc),$("#tg-jugada").html(d.jg.format(2)),$("#tg-balance").html(d.balance.format(2)),$("#reporte-body").html(jsrender($("#rd-reporte"),s)),n()}}function n(){var e=document.getElementById("exportar");e.href="#reporte/general";var t=t="SRQ - REPORTE "+r.inicio+"-"+r.fin+"."+m.val();"json"==m.val()?download("exportar",JSON.stringify(s,null,2),t,"text/plain"):"csv"==m.val()?notificacion("FORMATO NO DISPONIBLE"):html2canvas($("#print-img"),{onrendered:function(a){var o=a.toDataURL("image/png");e.href=o,e.download=t}})}var r,s,i=$("#reporte-fecha1"),c=$("#reporte-fecha2"),l=$("#reporte"),u=$("#prm-select"),d=$("#rp-agrupar"),f={bn:function(){return $usuario.nombre}};$("#reporte").submit(function(e){e.preventDefault(e),r=formControls(this),r.usuarioID=t[0];var a=formLock(this);$("#pheader").html(jsrender($("#rd-prtaq"),r,f)),socket.sendMessage("reporte-banca",{s:r,g:d.val()},function(e,t){formLock(a,!1),s=t||[],o()})}),u.change(o);var m=$("#formato");m.change(n),t&&t.length>1&&(a=t[1].split("-"),b=t[2].split("-"),i.datepicker("setDate",new Date(a[0],parseInt(a[1])-1,a[2])),c.datepicker("setDate",new Date(b[0],parseInt(b[1])-1,b[2])),l.trigger("submit"))}function reporteRecogedor_nav(e,t){function o(){if(0!=s.length){var e=0,t=0,a=0,o=0,r=0,l=0;s.forEach(function(a){a.balance=a.jg-a.pr-a.cmt,a.rango=i[0].value+"|"+c[0].value,l+=a.balance,e+=a.jg,t+=a.pr,o+=a.cmt,r+=a.rt});var u,d,f={j:e.format(2),pr:t.format(2),b:l.format(2),cm:o.format(2),r:r.format(2)};$("#bheader").html(jsrender($("#rd-total"),f)),$("#mnt-jugado").html(e.format(2)),$("#mnt-premios").html(t.format(2)),$("#mnt-pagos").html(a.format(2)),$("#mnt-balance").html(l.format(2)),$("#tg-descuento").html((o+r).format(2)),$("#tg-comision").html(o.format(2)),$("#tg-renta").html(r.format(2)),u=s.slice(),u.sort(function(e,t){return t.jg-e.jg}),d=u[0],$("#tj-banca").html(d.desc),$("#tj-jugada").html(d.jg.format(2)),$("#tj-balance").html(d.balance.format(2)),u=s.slice(),u.sort(function(e,t){return t.balance-e.balance}),d=u[0],$("#tg-banca").html(d.desc),$("#tg-jugada").html(d.jg.format(2)),$("#tg-balance").html(d.balance.format(2)),$("#reporte-body").html(jsrender($("#rd-reporte"),s)),n()}}function n(){var e=document.getElementById("exportar");e.href="#reporte/general";var t=t="SRQ - REPORTE "+r.inicio+"-"+r.fin+"."+m.val();"json"==m.val()?download("exportar",JSON.stringify(s,null,2),t,"text/plain"):"csv"==m.val()?notificacion("FORMATO NO DISPONIBLE"):html2canvas($("#print-img"),{onrendered:function(a){var o=a.toDataURL("image/png");e.href=o,e.download=t}})}var r,s,i=$("#reporte-fecha1"),c=$("#reporte-fecha2"),l=$("#reporte"),u=$("#prm-select"),d=$("#rp-agrupar"),f={bn:function(){return $usuario.nombre}};$("#reporte").submit(function(e){e.preventDefault(e),r=formControls(this),r.bancaID=t[0];var a=formLock(this);$("#pheader").html(jsrender($("#rd-prtaq"),r,f)),socket.sendMessage("reporte-recogedor",{s:r,g:d.val()},function(e,t){formLock(a,!1),s=t||[],o()})}),u.change(o);var m=$("#formato");m.change(n),t&&t.length>1&&(a=t[1].split("-"),b=t[2].split("-"),i.datepicker("setDate",new Date(a[0],parseInt(a[1])-1,a[2])),c.datepicker("setDate",new Date(b[0],parseInt(b[1])-1,b[2])),l.trigger("submit"))}function reporteTaquilla_nav(e,t){function a(){$("#reporte-body").html(jsrender($("#rd-reporte"),o))}var o,n=t[0],r=$("#reporte-fecha1"),s=$("#reporte-fecha2"),i=$("#reporte"),c=$("#prm-select"),l=$("#hb-taquilla"),u=$("#bancas");if(u.html(jsrender($("#rd-banca-option"),$bancas)),u.on("change",function(){l.html('<i class="fa fa-spinner fa-spin" ></i> Espere, recibiendo taquillas...'),socket.sendMessage("taquillas",{bancaID:u.val()},function(e,t){$("#taquillas").html(jsrender($("#rd-taquilla-option"),t)),l.remove()})}),u.trigger("change"),i.submit(function(e){e.preventDefault(e);var t=formControls(this),r=formLock(this);t.taquillaID=n,socket.sendMessage("reporte-taquilla",t,function(e,t){formLock(r,!1),t=t||[],o=t;var n,s,i=0,c=0,l=0,u=0;t.forEach(function(e){e.balance=e.jugada-e.premio,i+=e.jugada,c+=e.pago,l+=e.premio,u+=e.comision}),$("#mnt-jugado").html(i.format(2)),$("#mnt-premios").html(l.format(2)),$("#mnt-pagos").html(c.format(2)),$("#mnt-balance").html((i-l-u).format(2)),$("#tg-descuento").html(u.format(2)),$("#tg-comision").html(u.format(2)),n=t.slice(),n.sort(function(e,t){return t.jugada-e.jugada}),s=n[0],$("#tj-banca").html(s.descripcion),$("#tj-jugada").html(s.jugada.format(2)),$("#tj-balance").html(s.balance.format(2)),n=t.slice(),n.sort(function(e,t){return t.balance-e.balance}),s=n[0],$("#tg-banca").html(s.descripcion),$("#tg-jugada").html(s.jugada.format(2)),$("#tg-balance").html(s.balance.format(2)),a()})}),c.change(a),t&&t.length>0){var d=t[1].split("-"),f=t[2].split("-");r.datepicker("setDate",new Date(d[0],parseInt(d[1])-1,d[2])),s.datepicker("setDate",new Date(f[0],parseInt(f[1])-1,f[2])),i.trigger("submit")}}function reporteCobros_nav(e,t){var a,o=$("#reporte-fecha1"),n=$("#reporte-fecha2"),r=$("#reporte");if(_helpers.rgFiltro=function(){return o.val()&&n.val()?"|"+o.val()+"|"+n.val():""},r.submit(function(e){e.preventDefault(e);var t=formControls(this),r=formLock(this),s=$("#rp-agrupar").val();socket.sendMessage("reporte-cobros",{s:t,g:s},function(e,s){function i(){if(l.length>0){var e=l.shift(),a=copyTo(t);a.cid=e,socket.sendMessage("reporte-subcobros",{s:a,g:2},function(t,a){var o=0;a.forEach(function(t){t.cID=e,o+=t.jg*t.cm}),m+=o,$("#rnt"+e).html(o.format(2)),$("#renta").html(m.format(2));var n=jsrender($("#rd-reporte"),a);$(n).insertAfter("#c"+e),c(e),i()})}}function c(e=""){console.log("activando",e),$(".cbr-shutdown").off("click"),$(".cbr-shutdown").click(function(e){e.preventDefault(e),alert("Oops.. Esto aun no funciona ;) vuelva pronto...")}),$("#cbrfi"+e).switchClass("fa-folder-o","fa-folder"),$(`.cbr${e}-disable`).off("click"),$(`.cbr${e}-disable`).click(function(e){e.preventDefault(e);var t=$(this).attr("usID"),a=$("#"+t),o=$("#cbrbal-"+t);o.toggleClass("cbr-bal-act"),o.hasClass("cbr-bal-act")?a.css("opacity",1):a.css("opacity",.5)}),$(".cbr-bal").off("click"),$(".cbr-bal").on("click",function(e){e.preventDefault(e);var t=$(this).attr("usID"),a=parseFloat($(this).attr("monto")),r="COBRO SRQ SEMANA "+o.val()+"|"+n.val()+" "+$(this).attr("desc");socket.sendMessage("balance-add",{usID:t,monto:a,desc:r,cdo:1},function(e,t){$("#"+t.usID).addClass("success")})})}formLock(r,!1);var l=[];if(!s)return $("#reporte-body").html(""),void $(".clr").html("--");a=s;var u,d,f=0,m=0;s.forEach(function(e){f+=e.jg,m+=e.jg*e.cm,e.hasOwnProperty("cm")&&0==e.cm&&e.hasOwnProperty("cID")&&($("#rnt"+e.cID).html('<i class="fa fa-spinner fa-spin"></i>'),l.push(e.cID))}),i(),$("#mnt-jugado").html(f.format(2)),u=s.slice(),u.sort(function(e,t){return t.renta-e.renta}),d=u[0],$("#tj-banca").html(d.desc),$("#tj-jugada").html(d.jg.format(2)),$("#renta").html(m.format(2)),$("#reporte-body").html(jsrender($("#rd-reporte"),s)),$(".cbr-folder").click(function(e){e.preventDefault(e);var t=parseInt($(this).attr("fld"));$(this).attr("fld",1==t?0:1);var a=parseInt($(this).attr("fldid"));0==t?($(".subrow"+a).removeClass("hidden"),$(this).find("i").addClass("fa-folder-open")):($(".subrow"+a).addClass("hidden"),$(this).find("i").removeClass("fa-folder-open"))}),c()})}),$("#rtp-desc-o").click(function(e){e.preventDefault(e),a.sort(function(e,t){var a=0;return e=e.desc.toLowerCase(),t=t.desc.toLowerCase(),e>t&&(a=1),e<t&&(a=-1),a}),$("#reporte-body").html(jsrender($("#rd-reporte"),a))}),$("#cbr-procesar").click(function(){function e(a){var r=$(a).attr("usID"),s=parseFloat($(a).attr("monto")),i=parseFloat($("#minValor").val()),c=parseFloat($("#descuento").val()),l="COBRO SRQ "+o.val()+"|"+n.val()+", "+$(a).attr("desc");s<i&&(s=i,l="COBRO SRQ "+o.val()+"|"+n.val()+", "+$(a).attr("desc")+" *RENTA BASICA*"),c>0&&(l="COBRO SRQ "+o.val()+"|"+n.val()+", "+$(a).attr("desc")+" *TOTAL: "+s.toFixed(2)+" -"+c+"% DESCUENTO*",s-=s*c/100),socket.sendMessage("balance-add",{usID:r,monto:s,desc:l,cdo:1},function(a,o){$("#"+o.usID).addClass("success"),t.length>0?e(t.shift()):$("#cbr-procesar").prop("disabled",0)})}$(this).prop("disabled",1);var t=[];$(".cbr-bal-act").each(function(e,a){t.push(a)}),e(t.shift())}),t&&t.length>0){var s=t[0].split("-"),i=t[1].split("-");o.datepicker("setDate",new Date(s[0],parseInt(s[1])-1,s[2])),n.datepicker("setDate",new Date(i[0],parseInt(i[1])-1,i[2])),r.trigger("submit")}}function reporteCobrosComercial_nav(e,t){var a,o=$("#reporte-fecha1"),n=$("#reporte-fecha2"),r=$("#reporte");if(_helpers.rgFiltro=function(){return o.val()&&n.val()?"|"+o.val()+"|"+n.val():""},r.submit(function(e){e.preventDefault(e);var t=formControls(this),o=formLock(this),n=$("#rp-agrupar").val();socket.sendMessage("reporte-cobros",{s:t,g:n},function(e,t){if(formLock(o,!1),!t)return $("#reporte-body").html(""),void $(".clr").html("--");a=t;var n,r,s=0,i=0,c=0;t.forEach(function(e){e.balance=e.jugada-e.premio,s+=e.jugada,i+=e.premio,c+=e.renta,e.balance*e.participacion}),$("#mnt-jugado").html(s.format(2)),$("#mnt-premios").html(i.format(2)),n=t.slice(),n.sort(function(e,t){return t.renta-e.renta}),r=n[0],$("#tj-banca").html(r.desc),$("#tj-jugada").html(r.jugada.format(2)),$("#renta").html(c.format(2)),$("#reporte-body").html(jsrender($("#rd-reporte"),t))})}),$("#rtp-desc-o").click(function(e){e.preventDefault(e),a.sort(function(e,t){var a=0;return e=e.desc.toLowerCase(),t=t.desc.toLowerCase(),e>t&&(a=1),e<t&&(a=-1),a}),$("#reporte-body").html(jsrender($("#rd-reporte"),a))}),t&&t.length>0){t[0];var s=t[1].split("-"),i=t[2].split("-");o.datepicker("setDate",new Date(s[0],parseInt(s[1])-1,s[2])),n.datepicker("setDate",new Date(i[0],parseInt(i[1])-1,i[2])),r.trigger("submit")}}function reporteBalance_nav(e,t){function o(e){e.preventDefault(e);var t=$(this).attr("pago"),a=findBy("balID",t,s);askme("CONFIRMAR PAGO #"+t,jsrender($("#rd-procesar-pago"),a),{ok:function(e){var t=-1*parseFloat(e.monto);return n("PAGO:"+e.id+" B:"+padding(e.origen,4)+"-"+padding(e.destino,4)+" R:"+e.recibo+" F:"+e.fecha,t,e.cdo),!0}})}function n(e,t,a){var n={desc:e,monto:t,usID:r.usID,cdo:a};socket.sendMessage("balance-add",n,function(e,t){s.length>0?t.balance=t.monto+s[0].balance:t.balance=t.monto,s.unshift(t),$("#reporte-body").html(jsrender($("#rd-reporte-us"),s)),$("#bl-clients-total").html(t.balance.format(2)),$(".bl-pagar").click(o)})}var r,s;if(t&&t.length>0){function i(){$("#bl-us-name").html(r.nombre),$("#bl-clients-total").html("Cargando..."),socket.sendMessage("balance-general",{usID:r.usID},function(e,t){s=t||[],s.length>0?($("#reporte-body").html(jsrender($("#rd-reporte-us"),s)),$("#bl-clients-total").html(s[0].balance.format(2)),$(".balIDmap").hover(function(){var e=$(this).attr("balID");$(".hoverRow").removeClass("success warning"),s.forEach(function(t,a,o){t.desc.indexOf("PAGO:"+e)>-1&&($("#bidr"+t.balID).addClass("success"),$("#bidr"+e).addClass("warning"))})})):$("#bl-clients-total").html("0.00"),$(".bl-pagar").click(o)})}$(".bl-dreg").each(function(){$(this).removeClass("hidden")}),$(".bl-greg").each(function(){$(this).addClass("hidden")}),a=t[0].slice(1),r=findBy("usuarioID",a,$usuarios),r?i():socket.sendMessage("usuarios",{id:a},function(e,t){r=t[0],i()})}else{var c,l;$(".bl-dreg").addClass("hidden"),$(".bl-greg").removeClass("hidden"),g();var u=$(".toggle");function d(e){return 3==e.activo}function f(){c=$config.balance.filtrar?l.filter(d):l,$("#reporte-body").html(jsrender($("#rd-reporte"),c));var e=0;c.forEach(function(t){e+=t.balance}),$("#bl-clients-total").html(e.format(2));var t=new Date,a=t.format();t.setTime(t.getTime()-602e6);var o=t.format();p(o,a),$("#desde").val(o),$("#hasta").val(a),$(".bl-suspender").click(m),$(".bl-usmenu").click(function(e){e.preventDefault(e);var t=$(this).attr("usID"),a=t[0],o=t.substr(1),n=findBy("usID",t,c),r=n.activo;let s=notificacion(`ACCIONES: ${n.desc.toUpperCase()}`,jsrender($("#rd-blmenu"),{usID:t,tipo:a,uID:o,activo:r}));$(`#gritter-item-${s} > div.gritter-item > div.gritter-without-image > p > a`).click(function(e){$(this).hasClass("bl-suspender")&&m(e);let t=$(this).closest(".gritter-item-wrapper");t.remove()})})}function m(e){e.preventDefault(e);var t=$(e.currentTarget).attr("usID"),a=t.substr(1);console.log("activo",$(e.currentTarget).attr("usAc"));var o=0==parseInt($(e.currentTarget).attr("usAc"))?3:0,n=confirm("Confirma desea suspender/restaurar usuario?");n&&($("#bl-us"+t).html('<i class="fa fa-spinner fa-spin"></i>'),socket.sendMessage("usuario-editar",{usuarioID:a,activo:o},function(e,a){var n=findBy("usID",t,c);console.log(e,a),1==a.code?(n.activo=o,f()):notificacion("ERROR","OCURRIO UN ERROR AL SUSPENDER A "+n.nombre)}))}function p(e,t){socket.sendMessage("balance-pagos",{inicio:e,fin:t},function(e,t){if(t){$("#bl-pagos").html(jsrender($("#rd-reporte-pagos"),t));var a=0;t.forEach(function(e){a+=e.monto}),$("#bl-pagos-total").html(a.format(2))}else $("#bl-pagos-total").html("0.00");v()})}function v(){socket.sendMessage("balance-ppagos",null,function(e,t){function a(){if(t){var e=0;t.forEach(function(t){e+=t.monto}),$("#bl-ppagos").html(jsrender($("#rd-reporte-pend"),t)),$("#bl-ppagos-total").html(e.format(2)),$(".cf-pago").click(function(e){e.preventDefault(e);var a=$(this).attr("bid"),o=findBy("balID",a,t);askme("CONFIRMAR PAGO #"+o.balID,jsrender($("#rd-procesar-pendiente"),o),{ok:function(e){$("#cf-label").html("Espere.. confirmando pago.");var o=findBy("balID",a,t);e={bID:a,usID:o.usID,monto:e.monto};return socket.sendMessage("balance-confirmacion",e,function(e,t){$("#md-ask").modal("hide"),$("#cfpago"+a),g()}),!1}})}),$(".bl-rmv-pend").click(function(e){e.preventDefault(e);var o=$(this).attr("balID");socket.sendMessage("balance-remover-pend",{bID:o},function(e,n){if(confirm("Confirma remover pago pendiente?")){var r=findIndex("balID",o,t);t.splice(r,1),a()}})})}else $("#bl-ppagos-total").html("0.00"),$("#bl-ppagos").html("")}a()})}function g(){socket.sendMessage("balance-general",null,function(e,t){l=t||[],c=l.filter(d),f()})}u.each(function(e){var t=$(this);t.toggles({text:{on:"SI",off:"NO"},on:$config.balance.filtrar,click:!0})}),u.on("toggle",function(e,t){$config.balance.filtrar=t,saveConfig(),f()}),$("#bl-sort-desc").click(function(e){e.preventDefault(e);var t=parseInt($(this).attr("ord"));t=0==t?-1:t,$(this).attr("ord",-1*t),c.sort(function(e,a){return e.desc.toLowerCase()<a.desc.toLowerCase()?t:-1*t}),$("#reporte-body").html(jsrender($("#rd-reporte"),c))}),$("#bl-sort-monto").click(function(e){e.preventDefault(e);var t=parseInt($(this).attr("ord"));t=0==t?-1:t,$(this).attr("ord",-1*t),c.sort(function(e,a){return e.balance<a.balance?t:-1*t}),$("#reporte-body").html(jsrender($("#rd-reporte"),c))})}$("#bl-new-reg").submit(function(e){e.preventDefault(e);var t=formControls(this),a=formLock(this);n(t.desc,t.monto,1),formReset(a)}),$("#bl-fpagos").submit(function(e){e.preventDefault(e);var t=formControls(this);p(t.inicio,t.fin)})}function ticketsAnular(e,t){$("#anular").submit(function(e){e.preventDefault(e);for(var t,a=formControls(this),o=a.tickets.split(","),n=o.length-1;n>-1;n--)if(o[n].indexOf("-")>-1){t=o[n].split("-"),o.splice(n,1);for(var r=t[1];r>=t[0];r--)o.splice(n,null,r)}socket.sendMessage("venta-anular",o,function(e,t){notificacion(t+" TICKETS ANULADOS")})})}function sql_nav(e,t){function a(e,t){if(1==t.code){if(1==t.last)return formLock(r,!1),$("#ultimos").append(jsrender($("#rd-usql-s"),t)),o(),socket.removeListener("sql-command",a),n(),void $("#tiempo").html(t.time);var s,i="";l+=t.d.length;var c=t.d[0];for(s in i="<tr>",c)i+="<th>"+s+"</th>";i+="</tr>",$("#sqlhead").html(i),i="",t.d.forEach(function(e){for(s in i+="<tr>",e)i+="<td>"+e[s]+"</td>";i+="</tr>"}),$("#sqlresult").append(i),$("#result").html(l)}else 5==t.code&&(formLock(r,!1),socket.removeListener("sql-command",a),alert("ERROR: "+t.error.errorID+", "+t.error.details),$("#ultimos").append(jsrender($("#rd-usql-f"),t)),o(),n())}function o(){var e=$(".btnsql");e.off("click"),e.click(function(){window.editor.setValue($(this).html())})}function n(){++u<c.length&&(socket.addListener("sql-command",a),socket.sendMessage("sql-command",{sql:c[u]}))}var r=$("#sql"),s="text/x-mariadb";window.editor=CodeMirror.fromTextArea(document.getElementById("textsql"),{mode:s,indentWithTabs:!0,smartIndent:!0,lineNumbers:!0,matchBrackets:!0,autofocus:!0,extraKeys:{"Ctrl-Space":"autocomplete"},hintOptions:{tables:{users:["name","score","birthDate"],countries:["name","population","size"]}}}),o();const i=localStorage.getItem("srq.sqlcache.last");i&&window.editor.setValue(i);var c,l=0,u=0;r.submit(function(e){u=0,l=0,e.preventDefault(e);var t=formControls(this);formLock(this),localStorage.setItem("srq.sqlcache.last",t.sql),c=t.sql.split(";\n"),$("#sqlresult").html(""),socket.addListener("sql-command",a),socket.sendMessage("sql-command",{sql:c[0]})})}function midas_nav(e,t){var a=$("#midas"),o=$("#jgc"),n=$("#prc");a.submit(function(e){e.preventDefault(e);var t=formControls(this);formLock(this),socket.sendMessage("sys-midas",t,function(e,t){if(formLock(a,!1),null!=t){var r=t.length,s=0,i=0,c=0;rpr=0;var l=0;rst=0;for(var u=[],d=0;d<r;d++)l+=t[d].es?1:0,rst+=t[d].rs?1:0,s+=t[d].ej,i+=t[d].rj,c+=t[d].ep,rpr+=t[d].rp,t[d].ej==t[d].rj&&t[d].ep==t[d].rp||u.push(t[d]);var f=s==i,m=c==rpr;$("#st").html(l),$("#jg").html(s.format(2)),$("#pr").html(c.format(2)),$("#rst").html(rst),$("#rjg").html(i.format(2)),$("#rpr").html(rpr.format(2)),f?(o.html("JUGADA COINCIDE"),o.addClass("alert-success")):(o.html("JUGADA NO COINCIDE"),o.addClass("alert-danger")),m?(n.html("PREMIOS COINCIDEN"),n.addClass("alert-success")):(n.html("PREMIOS NO COINCIDEN"),n.addClass("alert-danger"));var p=$("#rd-midas");$("#tb-dif").html(jsrender(p,u)),$("#tb-midas").html(jsrender(p,t)),$(".mds-sorteo").click(function(e){e.preventDefault(e);var t=$(this),a=t.attr("mdssorteo");socket.sendMessage("sorteo",{sorteoID:a},function(e,t){$("a[mdssorteo='"+a+"']").html("#"+a+" "+t.descripcion)})})}})})}function monitorRendimiento_nav(e,t){function a(e,t){$("#msmax").html(t.max),n.length>0&&t.desc==n[0].d||(n.unshift({d:t.desc,ms:t.last}),$("#mt-msbody").html(jsrender($("#rd-msbody"),n)))}function o(e,t){return e.n>t.n?-1:e.n<t.n?1:0}var n=[],r=0,s=[];$("#mt-ms").click(function(){0==r?($("#msicon").switchClass("fa-send","fa-spinner fa-spin"),r=setInterval(function(){socket.sendMessage("sys-monitor",{m:"ms"},a)},1e3)):($("#msicon").switchClass("fa-spinner fa-spin","fa-send"),clearInterval(r),r=0)}),$("#mt-acc").click(function(){socket.sendMessage("sys-monitor",{m:"acc"},function(e,t){var a;for(a in s.length=0,t)s.push({d:a,n:t[a]});s.sort(o),$("#mt-accbody").html(jsrender($("#rd-accbody"),s))})})}function sysMant_nav(e,t){$("#sys-mant-run").submit(function(e){e.preventDefault(e);var t=formControls(this),a=formLock(this);socket.sendMessage("sys-mant",t,function(e,t){if(formLock(a,!1),1==t.code){var o=t.meta[0];o=o<1e3?o+"ms":(o/1e3).format()+"s",notificacion("MANTENIMIENTO FINALIZADO",jsrender($("#rd-mant-ok"),{tiempo:o,tickets:t.meta[1],ventas:t.meta[2],anulados:t.meta[3],pagos:t.meta[4]}),null,!0)}else notificacion("MANTENIMIENTO FINALIZADO","FALLIDA")})})}function bancasRelacionPremio_nav(e,t){function a(){s.html(jsrender($("#rd-usuario-option"),$usuarios)),s.select2("val",0),s.change(function(){o.html("<option disabled>CARGANDO...</option>"),o.select2("val",0),socket.sendMessage("bancas",{usuario:s.val()},function(e,t){o.html(jsrender($("#rd-banca-option"),t))})})}var o=$("#bancas"),n=$("#sorteo"),r=$("#relacion"),s=$("#usuarios");o.html(jsrender($("#rd-banca-option"),$bancas)),n.html(jsrender($("#rd-lsorteo-option"),$sorteos)),r.submit(function(e){e.preventDefault(e);var t=formControls(this);formLock(r),socket.sendMessage("banca-relacion",t,function(e,t){formLock(r,!1),t>0&&notificacion("RELACION PROCESADA CON EXITO")})}),$usuarios?a():socket.sendMessage("usuarios",null,function(e,t){$usuarios=t||[],a()})}nav.paginas.addListener(Navegador.ENTER,function(e,t){var a=jQuery(".mainpanel"),o=jQuery(document).height(),n=a.height();o>n&&a.height(o),$(".date").datepicker({dateFormat:"yy-mm-dd"}),$(".now").datepicker("setDate",new Date),$(".s2-elementos").html(jsrender($("#rd-elemento-option"),$elementos))}),nav.paginas.addListener(Navegador.COMPLETE,function(e,t){select2w($(".s2"),{allowClear:!0,minimumResultsForSearch:5}),jQuery(".panel-heading").click(function(){var e=jQuery(this).find(".minimize"),t=e.closest(".panel");return e.hasClass("maximize")?(t.find(".panel-body, .panel-footer").slideDown(200),e.removeClass("maximize"),e.html("&minus;")):(t.find(".panel-body, .panel-footer").slideUp(200),e.addClass("maximize"),e.html("&plus;")),!1}),$(".toLower").change(function(e){var t=$(e.target);t.val(t.val().toLowerCase())})}),nav.paginas.addListener("login",login_nav),nav.paginas.addListener("inicio",inicio_nav),nav.paginas.addListener("sorteos/monitor",sorteoMonitor_nav),nav.paginas.addListener("sorteos/buscar",sorteoBuscar_nav),nav.paginas.addListener("sorteos/nuevo",sorteoNuevo_nav),nav.paginas.addListener("sorteos/registrar",sorteoRegistrar_nav),nav.paginas.addListener("sorteos/frutas",sorteoFrutas_nav),nav.paginas.addListener("sorteos/premiar",sorteoPremiar_nav),nav.paginas.addListener("bancas/usuarios",bancasUsuarios_nav),nav.paginas.addListener("bancas/usuario",bancasUsuario_nav),nav.paginas.addListener("bancas/suspensiones",bancasSuspender_nav),nav.paginas.addListener("bancas/comercial",bancasComercial_nav),nav.paginas.addListener("bancas/banca",bancasBanca_nav),nav.paginas.addListener("bancas/taquillas",bancasTaquillas_nav),nav.paginas.addListener("bancas/taquilla",bancasTaquilla_nav),nav.paginas.addListener("bancas/topes",bancasTopes_nav),nav.paginas.addListener("reporte/general",reporteGeneral_nav),nav.paginas.addListener("reporte/comercial",reporteComercial_nav),nav.paginas.addListener("reporte/banca",reporteBanca_nav),nav.paginas.addListener("reporte/recogedor",reporteRecogedor_nav),nav.paginas.addListener("reporte/taquilla",reporteTaquilla_nav),nav.paginas.addListener("reporte/cobros",reporteCobros_nav),nav.paginas.addListener("reporte/cobros-comercial",reporteCobrosComercial_nav),nav.paginas.addListener("reporte/balance",reporteBalance_nav),nav.paginas.addListener("tickets/anular",ticketsAnular),nav.paginas.addListener("sql",sql_nav),nav.paginas.addListener("reporte/midas",midas_nav),nav.paginas.addListener("sistema/monitor",monitorRendimiento_nav),nav.paginas.addListener("sistema/mantenimiento",sysMant_nav),nav.paginas.addListener("bancas/relacionpremio",bancasRelacionPremio_nav);