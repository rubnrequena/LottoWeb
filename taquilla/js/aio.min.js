"use strict";var CONFIG={INTERFAZ_MODO:"srq.taq.modoInterfaz",IMPRIMIR_TECLA:"srq.taq.imprimirTecla",IMPRIMIR_FORMATO:"srq.taq.formatoImpresion",IMPRIMIR_MODO:"srq.taq.modoImpresion",IMPRIMIR_LETRASxLINEA:"srq.taq.letrasLinea",SORTEOS_ORDEN:"srq.taq.ordenSorteos",SMS_KEY:"srq.taq.smskey",ELEMENTOS_HASH:"srq.taq.helementos",ELEMENTOS:"srq.taq.elementos",MONEDA:"srq.taq.moneda",NOMBRE_CLIENTE:"srq.taq.nombreCliente",PROTOCOLO:"srq.taq.protocolo"},init=function(){function e(e,t){k.setItem(e,t),L[e.split(".").pop()]=t}function t(){$("#gritter-item-"+w).remove(),q.connect()}function n(e,t){if(!G)return;0!=e.toString().indexOf("58")&&(e=`58${e}`);let n=`http://104.129.171.151:3000/enviar/${e}/?texto=${t}`;fetch(n).then(e=>e.json()).then(e=>{_.push(e),k.setItem("srqtaq.ws.enviados",JSON.stringify(_)),$("#ws-count").html(_.length)})}function o(e){return e.cierra>J.hora&&1==e.abierta}function r(e,t){const n=B.find(e=>e.sorteoID==t),o=K[n.sorteo];return o.find(t=>t.id==e)}function a(e){return findBy("sorteoID",e,B)}function i(e){var t,n=[];return e.forEach(function(e){t=findBy("sorteoID",e,B),n.push(t?"<p>"+t.descripcion+"</p>":"<p>"+padding(e,5)+"</p>")}),n.join("")}function s(e){var t,n,o,r=[];return e.forEach(function(e){t=findBy("id",e.n,K),n=findBy("sorteoID",e.s,B),o=e.hasOwnProperty("td")?"CUPO DISPONIBLE: "+e.td:"CUPO DISPONIBLE: "+e.tm,t&&n&&r.push("<p>"+n.descripcion+": "+t.d+"</p><p>"+o+"</p>")}),r.join("")}function l(e,n){function l(e){e.preventDefault(e);const t=formControls(this),n=c(t.numero),o=we.val().trim()+" ";we.val(o+n.join(" ")),d()}function c(e){if(e=parseInt(e),isNaN(e))return;const t=100,n=1e3;let o=e,r=[];for(;o<n;)r.push(formatoTriple(o)),o+=t;return r}function d(){ge.modal("hide"),Ie[0].reset()}function m(e){e.preventDefault(e);const t=formControls(this),n=p(t.numero),o=we.val().trim()+" ";we.val(o+n.join(" ")),f()}function p(e){const t=e.split(" ");let n=parseInt(t[0]);const o=parseInt(t[1]);if(isNaN(n)||isNaN(o))return;let r=[];for(;n<=o;)r.push(formatoTriple(n++));return r}function f(){$e.modal("hide"),Oe[0].reset()}function u(e){e.preventDefault(e);const t=formControls(this),n=h(t.numero),o=we.val().trim()+" ";we.val(o+n.join(" ")),g()}function h(e){if(e=formatoTriple(e),isNaN(e))return;let t=e.toString().split("").reduce(function e(t,n,o,r){return t.concat(r.length>1&&r.slice(0,o).concat(r.slice(o+1)).reduce(e,[]).map(function(e){return[n].concat(e)})||n)},[]);return t.map(e=>e.join("")).reduce((e,t)=>e.indexOf(t)>-1?e:(e.push(t),e),[])}function g(){De.modal("hide"),ye[0].reset()}function v(){var e=document.getElementById("md-ticket-text");e.select(),e.setSelectionRange(0,99999),document.execCommand("copy"),Ae.text("Ticket copiado!"),Ae.addClass("btn-success"),setTimeout(()=>{Ae.text("Copiar"),Ae.removeClass("btn-success")},4e3)}function I(e){V.paginas.removeListener(Navegador.EXIT,I),$(document).off("keydown",ne)}function E(e){e.which==parseInt(L.imprimirTecla)&&(e.preventDefault(e),setTimeout(function(){O()},100)),107==e.which&&(e.preventDefault(e),$("#srqag-nombre").focus())}function O(){var e=$("#srag-input").val(),t=Ke.attr("evt")||"imprimir";Ke.removeAttr("evt"),1==ke&&(validateMail(e)?("reimprimir"==t?Ke.trigger(t,{tipo:"mail",numero:e}):D({mail:e}),Ke.modal("hide")):alert("CORREO INVALIDO")),3==ke&&(e=parseFloat(e).toString(),10==e.length&&(e="58"+e),validatePhone(e)?("reimprimir"==t?Ke.trigger(t,{tipo:"ws",numero:e}):D({wsc:e}),Ke.modal("hide")):alert("TELEFONO INVALIDO"))}function D(e){function t(e,n){if(Y=!1,k.removeItem("lastTk"),Ge.prop("disabled",Y),n.hasOwnProperty("code"))if(5==n.code)notificacion("SORTEOS INVALIDOS",i(n.sorteos));else if(6==n.code)notificacion("TOPE TAQUILLA EXEDIDO",s(n.elementos)),n.elementos.forEach(y),j();else if(7==n.code)notificacion("TOPE ANIMAL EXEDIDO",s(n.elementos)),n.elementos.forEach(y),j();else if(10==n.code)notificacion("JUGADA MINIMA NO PERMITIDA","La jugada minima debe ser superior a "+n.monto);else if(11==n.code)notificacion("SESION INVALIDA","No se ha podido verificar su sesion, por favor vuelva a iniciar sesion nuevamente");else if(12==n.code)notificacion("ERROR DE TICKET","Lo siento, hubo un error al leer el ticket, vuelva a intenarlo o comuniquese con su administrador");else if(101==n.code)notificacion("VENTA CONFIRMADA","TICKET: #"+n.tk.ticketID+"<br/><small>CODIGO: "+n.tk.codigo+"</small>"),S();else if(4==n.code){let e=(new Date).getTime();notificacion("TICKET POSIBLEMENTE DUPLICADO",`<p><b>Venta no confirmada</b><br>. En el ultimo minuto se ha vendido un ticket con caracteristicas muy parecidas al actual.</p>\n                        <p>Â¿Confirma que desea realizar esta venta?</p>\n                        <button id="vnt-confirmar${e}" class="btn btn-success btn-block">Confirmar</button>`),$("#vnt-confirmar"+e).click(function(e){$(this).closest(".gritter-item-wrapper").remove(),n.venta.m.rw=!0,x.sendMessage("venta",n.venta,t)})}else notificacion("TICKET RECHAZADO","Razon desconocida");else notificacion("VENTA CONFIRMADA","TICKET: #"+n.tk.ticketID+"<br/><small>CODIGO: "+n.tk.codigo+"</small>"),"print"==n.format?0==ke?T(n):4==ke?N(n):5==ke&&R(n):A(n),S()}if(0!=Me.length)if(Me.length>H.vnt_max_numtkt)notificacion("Limite de numeros exedido","Ha exedido el tope limite de numeros permitidos por ticket, comuniquese con su administrador.","growl-danger");else{for(var n=0,o=0;o<Me.length;o++)if(n+=Me[o].monto,Me[o].monto<H.vnt_min_num){const e=B.find(e=>e.sorteoID==Me[o].sorteoID),t=K[e.sorteo];var r=findBy("id",Me[o].numero,t);return void notificacion("MONTO MINIMO NUMERO","No es posible procesar la venta, el monto asignado al #"+r.n+" "+r.d+" no cumple con el minimo requerido ("+formatNumber(H.vnt_min_num,2)+") por su banca")}if(n<H.vnt_min_tkt)notificacion("MONTO MINIMO TICKET","No es posible procesar la venta, el monto total del ticket ("+n+") no cumple con el minimo requerido por su banca ("+formatNumber(H.vnt_min_tkt,2)+")");else if(Y)notificacion('<i class="fa fa-hand-stop-o"></i> ESPERE.. VENTA EN PROCESO.');else{if(!e){if(1==ke||3==ke)return void Ke.modal();if(-1==ke)return void $("#printbtn").click()}if(0!=ke||0!=P){Y=!0,Ge.prop("disabled",Y),k.setItem("lastTk",JSON.stringify(Me));var a={m:e||{},v:Me};"socket"==L.protocolo?x.sendMessage("venta",a,t):b(F,a).then(e=>{t("venta",e)})}else notificacion("ASISTENTE IMPRESION",jsrender($("#rd-print-alert")),"growl-danger")}}}function y(e){Me.forEach(function(t){t.sorteoID==e.s&&t.numero==e.n&&(t.monto=e.tm||e.td,t.tpte=!0,0==t.monto&&Me.splice(Me.indexOf(t),1))})}function C(e){qe=e,$("#tk-last").html(e.ticket.ticketID)}function A(e){try{e.vt.length!=Me.length&&alert("ALERTA: VERIFICAR TICKET, PUEDEN HABER CAMBIOS REALIZADOS POR EL SERVIDOR");for(var t=0;t<e.vt.length;t++)e.vt[t].sorteo=a(e.vt[t].sorteoID).descripcion;C({ticket:e.tk,ventas:e.vt})}catch(e){alert("SRQ HA DETECTADO UN ERROR, Por favor notificar a su administrador. ERROR: "+e.message),$("#vnt-ultimo").trigger("click")}}function N(e){for(var t=0;t<e.vt.length;t++)e.vt[t].sorteo=a(e.vt[t].sorteoID).descripcion;C({ticket:e.tk,ventas:e.vt}),ae(e.vt,e.tk)}function T(e){try{e.vt.length!=Me.length&&alert("ALERTA: VERIFICAR TICKET, PUEDEN HABER CAMBIOS REALIZADOS POR EL SERVIDOR");for(var t=0;t<e.vt.length;t++)e.vt[t].sorteo=a(e.vt[t].sorteoID).descripcion;C({ticket:e.tk,ventas:e.vt});var n=L.modoImpresion||1;"atm"==n&&(n=e.vt.length>6?2:1),Ze[n](e.vt,e.tk)}catch(e){alert("SRQ HA DETECTADO UN ERROR, Por favor notificar a su administrador. ERROR: "+e.message),$("#vnt-ultimo").trigger("click")}}function R(e){for(var t=0;t<e.vt.length;t++)e.vt[t].sorteo=a(e.vt[t].sorteoID).descripcion;C({ticket:e.tk,ventas:e.vt});var n=ie(e.vt,e.tk);$("#md-ticket-text").val(n),$("#md-copy-ticket").modal(),setTimeout(()=>{v()},200);let o=n.split("\n").join("%0a");$("#btn_sendTicketWS").attr("href",`https://api.whatsapp.com/send?text=${o}`),$("#btn_sendTicketWS").attr("msg",o)}function S(){Me.length=0,we.focus(),j()}function j(){Me.sort(function(e,t){var n=e.sorteoID,o=t.sorteoID,r=e.numero,a=t.numero;return n==o?r-a:n-o}),$("#vnt-cesta").html(jsrender($("#rd-cesta-row"),Me,Fe)),$(".rem-cesto").click(function(e){e.preventDefault(e);var t=parseInt($(e.currentTarget).attr("indice"));Me.splice(t,1),j()});var e=0;Me.forEach(function(t){e+=parseFloat(formatNumber(t.monto,2,".",""))}),Ue.html(e.format(2)),Ue.attr("datan",e.format(2,".","")),Me.forEach(function(e){delete e.tpte})}function _(){0==L.ordenSorteos?B.sort(U):B.sort(Z);const e=B.filter(o);console.log("ACTUALIZANDO LISTADO DE SORTEOS >>",e.length),Pe.html(jsrender($("#rd-sorteo-option"),e))}function U(e,t){var n=e.sorteo,o=t.sorteo,r=e.cierra,a=t.cierra;return n==o?r-a:n-o}function Z(e,t){var n=e.cierra,o=t.cierra;return n-o}function Q(e,t){for(var n=0;n<Me.length;n++)if(Me[n].sorteoID==e&&Me[n].numero==t)return n;return-1}function W(e,t){return new Promise((n,o)=>{t="00"!=t?parseInt(t):t;const r=K[e];if(r){const e=r.find(e=>e===t||e.n==t);e?n(e.id):notificacion(`El numero ${t} no esta registrado, favor ingrese un numero valido.`)}else ee().then(()=>{W(e,t).then(e=>n(e))})})}function ee(){return new Promise(e=>{function t(n,o){o.hasOwnProperty("hash")&&(x.removeListener(n,t),e())}x.addListener("elementos-init",t),M={},x.sendMessage("elementos-init")})}function te(e){if(e.altKey){if(80==e.which){e.preventDefault(e);const t=we.val(),n=h(t);we.val(n.join(" "))}if(83==e.which){e.preventDefault(e);const t=we.val(),n=c(t);we.val(n.join(" "))}if(67==e.which){e.preventDefault(e);const t=we.val(),n=p(t);we.val(n.join(" "))}if(84==e.which){e.preventDefault(e);const t=$("#terminales-marca"),n=t.is(":checked");t.prop("checked",!n)}}}function ne(e){if(121==e.which&&(e.preventDefault(e),$("#md-sorteos").modal("show")),e.altKey&&e.which>=96&&e.which<=105){e.preventDefault(e);var t=e.which-96;Me.splice(t-1,1),j()}switch(e.ctrlKey&&88==e.which&&(e.preventDefault(e),$("#md-anularTicket").modal()),e.which){case 13:e.target.id==Je||"vnt-numeros"==e.target.id?(e.preventDefault(e),we.select2("close"),_e.focus(),_e.select()):e.target.id==He&&(e.preventDefault(e),Pe.select2("close"),we.select2("open"),we.focus());break;case parseInt(L.imprimirTecla):e.preventDefault(e),D(),Pe.select2("close");break;case 109:e.preventDefault(e),Me.length>0?(Me.pop(),j()):(we.select2("close"),Pe.val(null).trigger("change"),Pe.select2("open"));break;case 36:e.preventDefault(e),e.target.id==Je?(we.select2("close"),_e.focus(),_e.select()):e.target.id==He?(Pe.select2("close"),we.select2("open"),we.focus()):(Pe.select2("open"),Pe.focus())}}function oe(e){if(1==L.nombreCliente){let t=prompt("Nombre del cliente");t=t.trim().substr(0,10).toLowerCase(),e.cliente=t}return e}function re(e,t,n){oe(t),n=n||!1;var o=[{type:"linea",text:G.nombre,align:"center"},{type:"linea",text:t.hora,align:"center"}];n?o.push({type:"linea",text:"S:"+padding(t.ticketID,6)+" N:"+e.length,align:"center"}):o.push({type:"linea",text:"S:"+padding(t.ticketID,6)+" C:"+padding(t.codigo)+" N:"+e.length,align:"center"}),o.push({type:"linea",text:"TICKET - CADUCA 3 DIAS",align:"center"}),e.sort(function(e,t){var n=e.sorteoID,o=t.sorteoID,r=e.numero,a=t.numero;return n==o?r-a:n-o});var a,i=e[0];o.push({type:"linea",text:i.sorteo,align:"center"});for(var s=0;s<e.length;s++)i.sorteoID!=e[s].sorteoID&&o.push({type:"linea",text:e[s].sorteo,align:"center"}),i=e[s],a=r(i.num||i.numero,i.sorteoID),o.push({type:"linea",text:["#"+a.d,i.monto.formatoMoneda()+L.moneda].join("\t "),align:"center"});o.push({type:"linea",text:"T:"+t.monto.formatoMoneda()+L.moneda+" AG"+X,align:"left"}),t.cliente&&o.push({type:"linea",text:`CLIENTE: ${t.cliente}`,align:"left"}),o.push({type:"linea",text:" ",align:"left"}),q.sendMessage("print",{data:o,printer:1})}function ae(e,t,n){function o(e){s.text(e,10,a),a+=i}oe(t),n=n||!1;var a=10,i=8,s=new jsPDF,l=[{type:"linea",text:G.nombre.toUpperCase(),align:"center"},{type:"linea",text:t.hora,align:"center"}];n?(l.push({type:"linea",text:"S:"+padding(t.ticketID,6)+" N:"+e.length,align:"center"}),l.push({type:"linea",text:"COPIA - CADUCA 3 DIAS",align:"center"})):(l.push({type:"linea",text:"S:"+padding(t.ticketID,6)+" C:"+padding(t.codigo)+" N:"+e.length,align:"center"}),l.push({type:"linea",text:"TICKET - CADUCA 3 DIAS",align:"center"})),e.sort(function(e,t){var n=e.sorteoID,o=t.sorteoID,r=e.numero,a=t.numero;return n==o?r-a:n-o});var c,d,m=e[0],p=[],f=[],u={},h=0,g=0,v=1;f[h]=[{field:"l1",text:m.sorteo,width:"50"},{field:"l2",text:" ",width:"50"}],p[g]=[];for(var I=0;I<e.length;I++)m.sorteoID!=e[I].sorteoID&&(2==v&&p[g].push(u),l.push({type:"tabla",header:!1,columns:f[h++],data:p[g++]}),f[h]=[{field:"l1",text:e[I].sorteo,width:"50"},{field:"l2",text:" ",width:"50"}],p[g]=[],v=1,u={}),m=e[I],c=r(m.num||m.numero,m.sorteoID),2==v?(v=1,u.l2=`${c.d} ${m.monto.formatoMoneda()}${L.moneda}`,p[g].push(u),u={}):(v=2,u.l1=`${c.d} ${m.monto.formatoMoneda()}${L.moneda}`,u.l2=" ");2==v&&p[g].push(u),l.push({type:"tabla",header:!1,columns:f[h++],data:p[g++]}),l.push({type:"linea",text:"T:"+t.monto.formatoMoneda()+L.moneda+" AG"+X,align:"left"}),t.cliente&&l.push({type:"linea",text:`CLIENTE: ${t.cliente}`,align:"left"});for(var $=0;$<l.length;$++)if(d=l[$],"linea"==d.type)o(d.text);else if("tabla"==d.type){var E=d.columns[0];o(E.text);for(var O,D=d.data,y=0;y<D.length;y++){O=D[y];var C="";O.hasOwnProperty("l1")&&(C+=O.l1+"\t"),O.hasOwnProperty("l2")&&(C+=O.l2),o(C)}}s.save("SRQ-"+t.ticketID)}function ie(e,t,n){oe(t),n=n||!1;var o=[{text:`*${G.nombre}*`},{text:t.hora}];n?(o.push({text:`S: *${padding(t.ticketID,6)}* N:${e.length}`}),o.push({text:"COPIA - CADUCA 3 DIAS"})):(o.push({text:`S: *${padding(t.ticketID,6)}* C: *${padding(t.codigo)}* N:${e.length}`}),o.push({text:"TICKET - CADUCA 3 DIAS"})),e.sort(function(e,t){var n=e.sorteoID,o=t.sorteoID,r=e.numero,a=t.numero;return n==o?r-a:n-o});for(var r=e[0],a=[],i=0;i<e.length;i++)r.sorteoID!=e[i].sorteoID&&(o.push({text:`*_${r.sorteo}_*`}),a.sort(pe),me(a,o),a=[]),a.push(e[i]),r=e[i];o.push({text:`*_${r.sorteo}_*:`}),a.sort(pe),me(a,o),o.push({text:`*TOTAL: ${t.monto.formatoMoneda()+L.moneda}*`}),t.cliente&&o.push({type:"linea",text:`CLIENTE: ${t.cliente}`,align:"left"});let s=o.map(e=>e.text);return s.join("\n")}function se(e,t,n){oe(t),n=n||!1;var o=[{type:"linea",text:G.nombre,align:"center"},{type:"linea",text:t.hora,align:"center"}];n?(o.push({type:"linea",text:"S:"+padding(t.ticketID,6)+" N:"+e.length,align:"center"}),o.push({type:"linea",text:"COPIA - CADUCA 3 DIAS",align:"center"})):(o.push({type:"linea",text:"S:"+padding(t.ticketID,6)+" C:"+padding(t.codigo)+" N:"+e.length,align:"center"}),o.push({type:"linea",text:"TICKET - CADUCA 3 DIAS",align:"center"})),e.sort(function(e,t){var n=e.sorteoID,o=t.sorteoID,r=e.numero,a=t.numero;return n==o?r-a:n-o});var a,i=e[0],s=[],l=[],c={},d=0,m=0,p=1;l[d]=[{field:"l1",text:i.sorteo,width:"50"},{field:"l2",text:" ",width:"50"}],s[m]=[];for(var f=0;f<e.length;f++)i.sorteoID!=e[f].sorteoID&&(2==p&&s[m].push(c),o.push({type:"tabla",header:!1,columns:l[d++],data:s[m++]}),l[d]=[{field:"l1",text:e[f].sorteo,width:"50"},{field:"l2",text:" ",width:"50"}],s[m]=[],p=1,c={}),i=e[f],a=r(i.num||i.numero,i.sorteoID),2==p?(p=1,c.l2=a.d.substr(0,6)+" "+i.monto.formatoMoneda()+L.moneda,s[m].push(c),c={}):(p=2,c.l1=a.d.substr(0,6)+" "+i.monto.formatoMoneda()+L.moneda,c.l2=" ");2==p&&s[m].push(c),o.push({type:"tabla",header:!1,columns:l[d++],data:s[m++]}),o.push({type:"linea",text:"T:"+t.monto.formatoMoneda()+L.moneda+" AG"+X,align:"left"}),t.cliente&&o.push({type:"linea",text:`CLIENTE: ${t.cliente}`,align:"left"}),o.push({type:"linea",text:" ",align:"left"}),q.sendMessage("print",{data:o,printer:1})}function le(e,t,n){oe(t),n=n||!1;var o=[{type:"linea",text:G.nombre,align:"center"},{type:"linea",text:t.hora,align:"center"}];n?(o.push({type:"linea",text:"S:"+padding(t.ticketID,6)+" N:"+e.length,align:"center"}),o.push({type:"linea",text:"COPIA - CADUCA 3 DIAS",align:"center"})):(o.push({type:"linea",text:"S:"+padding(t.ticketID,6)+" C:"+padding(t.codigo)+" N:"+e.length,align:"center"}),o.push({type:"linea",text:"TICKET - CADUCA 3 DIAS",align:"center"})),e.sort(function(e,t){var n=e.sorteoID,o=t.sorteoID,r=e.numero,a=t.numero;return n==o?r-a:n-o});var a,i=33,s=e[0],l=[],c=[],d={},m=0,p=0,f=1;c[m]=[{field:"l1",text:s.sorteo,width:i},{field:"l2",text:" ",width:i},{field:"l3",text:" ",width:i}],l[p]=[];for(var u=0;u<e.length;u++)s.sorteoID!=e[u].sorteoID&&(f<4&&l[p].push(d),o.push({type:"tabla",header:!1,columns:c[m++],data:l[p++]}),c[m]=[{field:"l1",text:e[u].sorteo,width:i},{field:"l2",text:" ",width:i},{field:"l3",text:" ",width:i}],l[p]=[],f=1,d={}),s=e[u],a=r(s.num||s.numero,s.sorteoID),3==f?(f=1,d.l3=[a.n+"x"+s.monto.formatoMoneda()].join("\t "),l[p].push(d),d={}):2==f?(f++,d.l2=[a.n+"x"+s.monto.formatoMoneda()].join("\t ")):(f++,d.l1=[a.n+"x"+s.monto.formatoMoneda()].join("\t "),d.l2=" ",d.l3=" ");2!=f&&3!=f||l[p].push(d),o.push({type:"tabla",header:!1,columns:c[m++],data:l[p++]}),o.push({type:"linea",text:"T:"+t.monto.formatoMoneda()+L.moneda+" AG"+X,align:"left"}),t.cliente&&o.push({type:"linea",text:`CLIENTE: ${t.cliente}`,align:"left"}),o.push({type:"linea",text:" ",align:"left"}),q.sendMessage("print",{data:o,printer:1})}function ce(e,t,n){oe(t),n=n||!1;var o=[{type:"linea",text:G.nombre,align:"center"},{type:"linea",text:t.hora,align:"center"}];n?(o.push({type:"linea",text:"S:"+padding(t.ticketID,6)+" N:"+e.length,align:"center"}),o.push({type:"linea",text:"COPIA - CADUCA 3 DIAS",align:"center"})):(o.push({type:"linea",text:"S:"+padding(t.ticketID,6)+" C:"+padding(t.codigo)+" N:"+e.length,align:"center"}),o.push({type:"linea",text:"TICKET - CADUCA 3 DIAS",align:"center"})),e.sort(function(e,t){var n=e.sorteoID,o=t.sorteoID,r=e.numero,a=t.numero;return n==o?r-a:n-o});for(var r=e[0],a=[],i=0;i<e.length;i++)r.sorteoID!=e[i].sorteoID&&(o.push({type:"linea",text:r.sorteo,align:"left"}),a.sort(pe),me(a,o),a=[]),a.push(e[i]),r=e[i];o.push({type:"linea",text:r.sorteo,align:"left"}),a.sort(pe),me(a,o),o.push({type:"linea",text:"T:"+t.monto.formatoMoneda()+L.moneda+" AG"+X,align:"left"}),t.cliente&&o.push({type:"linea",text:`CLIENTE: ${t.cliente}`,align:"left"}),o.push({type:"linea",text:" ",align:"left"}),q.sendMessage("print",{data:o,printer:1})}function de(e,t,n){oe(t),n=n||!1;var o=[{type:"linea",text:G.nombre,align:"center"},{type:"linea",text:t.hora,align:"center"}];n?o.push({type:"linea",text:"S:"+padding(t.ticketID,6)+" N:"+e.length,align:"center"}):o.push({type:"linea",text:"S:"+padding(t.ticketID,6)+" C:"+padding(t.codigo)+" N:"+e.length,align:"center"}),o.push({type:"linea",text:"T:"+t.monto.formatoMoneda()+L.moneda+" AG"+X,align:"left"}),t.cliente&&o.push({type:"linea",text:`CLIENTE: ${t.cliente}`,align:"left"}),o.push({type:"linea",text:" ",align:"left"}),q.sendMessage("print",{data:o,printer:1})}function me(e,t){function n(e,n){o=fe(e).join(",")+"x"+n.monto.formatoMoneda(),t.push({type:"linea",text:o,align:"left"});o.split(",")}for(var o,a=e[0],i=[],s=0;s<e.length;s++){e[s].monto!=a.monto&&(n(i,a),i=[]);const t=e[s].num||e[s].numero,o=r(t,e[s].sorteoID);i.push(o.n),a=e[s]}n(i,a)}function pe(e,t){var n=e.monto,o=t.monto,r=e.numero,a=t.numero;return n==o?r-a:n-o}function fe(e){for(var t,n,o=[e[0]],r=1;r<e.length;r++)t=parseInt(e[r]),n=parseInt(e[r-1])+1,t!=n&&(o[o.length-1]!=e[r-1]&&(o[o.length-1]+=" al "+e[r-1]),o.push(e[r]));return t==n&&o[o.length-1]!=e[r-1]&&(o[o.length-1]+=" al "+e[r-1]),o}if(!B)return void V.nav("101");$("#teclaimprimir").html(getKeyName(L.imprimirTecla));var ue=$("#triples-acciones"),he=$("#terminales-marca");const ge=$("#md-serie");ge.on("shown.bs.modal",e=>$("#serie-numero").focus());const ve=$("#serie-btn");ve.click(e=>ge.modal());const Ie=$("#serie-form");Ie.submit(l);const $e=$("#md-corrida");$e.on("shown.bs.modal",e=>$("#corrida-numero").focus());const Ee=$("#corrida-btn");Ee.click(e=>$e.modal());const Oe=$("#corrida-form");Oe.submit(m);const De=$("#md-permuta");De.on("shown.bs.modal",e=>$("#permuta-numero").focus());const ye=$("#permuta-form");ye.submit(u);const Ce=$("#permuta-btn");Ce.click(e=>De.modal()),$("#md-copy-ticket").on("hidden.bs.modal",function(e){Pe.select2("focus")});const Ae=$("#btn_copyClipboard");Ae.click(v),$("#number_sendWS").on("input",e=>{let t=$("#btn_sendTicketWS");const n=t.attr("msg");let o=e.target.value.length>0?`phone=58${e.target.value}&`:"";t.attr("href",`https://api.whatsapp.com/send?${o}text=${n}`)});let Ne=B.filter(o).reduce((e,t)=>{if(e.length>0){let n=e[e.length-1];n.sorteo.sorteo!=t.sorteo?e.push({sorteo:cloneTo(t),sorteos:[cloneTo(t)]}):n.sorteos.push(cloneTo(t))}else e.push({sorteo:cloneTo(t),sorteos:[cloneTo(t)]});return e},[]);const Te=/\d{1,2}[APM]+/,be=/\d{1,2}:\d{1,2}[ APM]+/,xe=/\d{1,2}[AMP]+|\d{1,2}:\d{1,2}[AMP ]+/;Ne.forEach(e=>{const t=K[e.sorteo.sorteo];if(t){const n=t.length;e.tipo=n<100?0:n<1e3?1:2}e.sorteo.descripcion=e.sorteo.descripcion.replace(Te,""),e.sorteo.descripcion=e.sorteo.descripcion.replace(be,""),e.sorteos.sort((e,t)=>e.cierra-t.cierra)}),Ne=Ne.sort((e,t)=>e.sorteo.descripcion<t.sorteo.descripcion?-1:t.sorteo.descripcion<e.sorteo.descripcion?1:0),$(".md-sorteos-body").html(jsrender($("#rd-md-sorteos"),Ne,{horario:e=>xe.exec(e)[0]})),$(".sorteos-hub-btn").click(()=>{let e=[];$(".sorteo-hub-item").each((t,n)=>{const o=$(n).is(":checked");o&&e.push($(n).attr("sorteo"))}),Pe.select2("val",e),$("#md-sorteos").modal("hide")}),$(".srt-hub-padre").change(function(){const e=$(this).is(":checked"),t=$(this).attr("sorteo");$(`.srt-hub-${t}`).prop("checked",e)}),$("#sorteosHub").click(e=>{e.preventDefault(),$("#md-sorteos").modal("show")}),$(".md-filtrar-sorteo").click(e=>{const t=$(e.target).html();let n=Ne;"ANIMALES"==t?n=Ne.filter(e=>0==e.tipo):"TERMINALES"==t?n=Ne.filter(e=>1==e.tipo):"TRIPLES"==t&&(n=Ne.filter(e=>2==e.tipo)),$(".md-sorteos-body").html(jsrender($("#rd-md-sorteos"),n,{horario:e=>xe.exec(e)[0]}))});var ke=L.formatoImpresion||0;if(ke>0?(1==ke&&$("#printbtn").html('<i class="fa fa-envelope"></i> ENVIAR'),2==ke&&$("#printbtn").html('<i class="fa fa-mobile-phone"></i> ENVIAR'),4==ke&&$("#printbtn").html('<i class="fa fa-file"></i> IMPRIMIR')):ke<0&&($("#print-group").html(jsrender($("#print-select"))),$("#print-paper").click(function(e){e.preventDefault(e),ke=0,$("#print-label").html('<i class="fa fa-print"></i> IMPRIMIR'),D()}),$("#print-mail").click(function(e){e.preventDefault(e),ke=1,$("#print-label").html('<i class="fa fa-envelope"></i> ENVIAR'),Ke.modal()}),$("#print-pdf").click(function(e){e.preventDefault(e),ke=4,$("#print-label").html('<i class="fa fa-file"></i> IMPRIMIR'),D({pdf:!0})}),$("#print-pantalla").click(function(e){e.preventDefault(e),ke=5,$("#print-label").html('<i class="fa fa-desktop"></i> IMPRIMIR'),D({pantalla:!0})}),$("#print-ws").click(function(e){e.preventDefault(e),ke=3,$("#print-label").html('<i class="fa fa-whatsapp"></i> ENVIAR'),Ke.modal()})),localStorage.getItem("lastTk")){for(var Re=JSON.parse(localStorage.getItem("lastTk")),Se=0,Le=0;Le<Re.length;Le++)Se+=Re[Le].monto;localStorage.removeItem("lastTk"),notificacion("TICKET PENDIENTE","Posiblemente el ultimo ticket enviado por <b>"+Se.format(2)+"bs</b>, no se confirmo. </br>Por favor proceda a verificar.",null,!0)}$("body").hasClass("leftpanel-collapsed")||$(".menutoggle").trigger("click"),$(".s2a").select2({openOnEnter:!1}),V.paginas.addListener(Navegador.EXIT,I),$("#taq-nombre").html(G.nombre);var Me=[],we=$("#vnt-numeros"),Pe=$("#vnt-sorteos");Pe.on("change",e=>{let t=!1;for(let n=0;n<e.val.length;n++){const o=e.val[n],r=B.find(e=>e.sorteoID==o);if(r&&r.descripcion.indexOf("TRIPLE")>=0){t=!0;break}}t?(ue.removeClass("hidden"),$("#terminal-marca-group").removeClass("hidden")):(ue.addClass("hidden"),$("#terminal-marca-group").addClass("hidden"),he.prop("checked",!1))});var qe,je,_e=$("#vnt-monto"),Ue=$("#vnt-total"),Ge=$("#vnt-btn"),Fe={pleno:function(e,t){const n=r(e,t);return"#"+n.d},num:function(e,t){return r(e,t).n},sorteo:function(e){var t=findBy("sorteoID",e,B);return t.descripcion},formatn:formatNumber},Ke=$("#md-srqag"),Be=$("#srag-input"),ze=k.getItem("srqag.agenda")?JSON.parse(k.getItem("srqag.agenda")):[{n:"",v:""}];Be.html(jsrender($("#rd-srqag-item"),ze)),Ke.on("shown.bs.modal",function(e){$("#srag-input").select2("focus"),Ke.on("keydown",E),$(document).off("keydown",ne)}),Ke.on("hide.bs.modal",function(e){Ke.off("keydown",E),$(document).on("keydown",ne)}),Ke.on("send",()=>{alert("enviando venta por...")}),$("#srqag-nuevo").submit(function(e){$(".srqag-ferror").addClass("hidden"),e.preventDefault(e);var t=formControls(this),n=findIndex("v",t.valor,ze);if(n>-1)$("#srqag-existeh").removeClass("hidden");else{var o=0;validateMail(t.valor)&&o++,parseInt(t.valor)&&o++,o>0?(ze.push({n:t.nombre,v:t.valor}),ze.sort(function(e,t){return e.n.localeCompare(t.n)}),Be.html(jsrender($("#rd-srqag-item"),ze)),formReset(this),Be.select2("focus"),k.setItem("srqag.agenda",JSON.stringify(ze)),$("#srqag-mailg").removeClass("has-error"),$("#srqag-to").addClass("hidden"),$("#srqag-existeh").addClass("hidden")):($("#srqag-mailg").addClass("has-error"),$("#srqag-to").removeClass("hidden"))}}),$("#srqag-rem").click(function(e){e.preventDefault(e);var t=Be.prop("selectedIndex");ze.splice(t,1),k.setItem("srqag.agenda",JSON.stringify(ze)),Be.html(jsrender($("#rd-srqag-item"),ze)),Be.select2("val","")}),$("#md-enviar-ok").click(O),$("#todoElDia").click(function(e){e.preventDefault();let t=Pe.select2("val");if(t.length>1)return notificacion("Esta funcion solo permite tomar un sorteo como referencia");let n=findBy("sorteoID",t[0],B),o=exploreBy("sorteo",n.sorteo,B).map(e=>e.sorteoID);Pe.select2("val",o).trigger("change"),we.select2("focus")}),$("#vnt-clr").click(S),Ge.click(function(){D()}),$("#vnt-venta").submit(function(t){function n(e,t){return new Promise((n,r)=>{if(t.descripcion.indexOf("TRIPLE")>-1){const r=t.descripcion.replace("TRIPLE","TERMINAL"),a=B.find(e=>e.descripcion==r);a?(e=formatoTriple(e).substr(1),W(a.sorteo,e).then(t=>{o(t,a.sorteoID,e),n()})):n()}else n()})}function o(e,t){if(e>-1){var n=Q(t,e);n>-1?Me[n].monto+=a.monto:Me.push({numero:e,monto:a.monto,sorteoID:t})}}function r(){j(),we.val(null).trigger("change"),"venta"==e?we.select2("focus"):$(we).focus()}t.preventDefault(t);var a=formControls(this);if(""!=a.monto&&0!==a.monto){if("object"!=typeof a.numero){a.numero=a.numero.trim(),a.numero=a.numero.replace(/^[\D]+/g,""),a.numero=a.numero.replace(/[^\/\d]+/g," "),a.numero=a.numero.replace(/[\D]+$/g,""),a.numero=a.numero.split(" ");for(var i=a.numero.length-1;i>=0;i--)if(a.numero[i].indexOf("/")>-1){var s=a.numero[i].split("/");s.sort(function(e,t){return parseInt(e)-parseInt(t)}),a.numero.splice(i,1);for(var l=parseInt(s[0]),c=parseInt(s[1]),d=i,m=l;m<=c;m++)a.numero.splice(d++,0,padding(m,1))}}for(let e=0;e<a.numero.length;e++){let t=a.numero[e];m=parseInt(t);if(m>0&&m<10&&(t="0"+m),!a.sorteos)return notificacion("SELECCIONE AL MENOS UN (1) SORTEO","","growl-danger");const s=he.is(":checked");for(let e=0;e<a.sorteos.length;e++){const l=a.sorteos[e],c=findBy("sorteoID",l,B);if(0==c.zodiacal)W(c.sorteo,t).then(e=>{e>-1&&(o(e,l,t),s?n(t,c).then(r):r())});else{var p=Qe.select2("val");if(p.length>0){if(p.indexOf("TODOS")>-1)for(p=new Array(Xe.length),i=1;i<Xe.length;i++)p[i]=Xe[i].zID;for(i=0;i<p.length;i++)we=W(c.sorteo,t+p[i]),o(we,l,t)}else we=W(c.sorteo,t),o(we,l,t)}}}}else _e.focus()}),Pe.on("change",function(e){1==Pe.select2("val").length?$("#todoElDia").removeClass("hidden"):$("#todoElDia").addClass("hidden");var t=null;if(e.val&&e.val.length>0){t=findBy("sorteoID",e.val[0],B);for(var n=1;n<e.val.length;n++)if(t.sorteo!=findBy("sorteoID",e.val[n],B).sorteo){t=null;break}}if(t){var o=K[t.sorteo];we.html(jsrender($("#rd-elemento-sorteo-option"),o))}else we.html(jsrender($("#rd-elemento-option"),z));we.select2("val",null).trigger("change");var r=$("#fg-zodiaco");r.addClass("hidden");let a=e.val?e.val:Pe.select2("val");a.forEach(function(e){var t=findBy("sorteoID",e,B);1!=t.zodiacal||r.removeClass("hidden")})}),$("#vnt-dia").click(function(e){var t=new Date(J.hora);V.url("reporte/diario",[t.format()])}),$(".vnt-reimprimir").click(function(e){function n(e,t){var n;if(t.ventas)if(t.ventas.forEach(function(e){e.ventaID=padding(e.ventaID,6),n=a(e.sorteoID),n&&(e.srt=n.descripcion)}),C(t),0==ke){var o=L.modoImpresion||1;"atm"==o&&(o=qe.ventas.length>6?2:1),Ze[o](qe.ventas,qe.ticket,!0)}else 4==ke?ae(t.ventas,t.ticket):3==ke&&(Ke.attr("evt","reimprimir"),Ke.on("reimprimir",(e,n)=>{Ke.off("reimprimir"),"ws"===n.tipo&&imprimirVentas_ws(n.numero,t.ventas,t.ticket,!0)}),Ke.modal())}if(e.preventDefault(e),ke=$(this).attr("formato"),0==P&&"0"==ke)return w=notificacion("ASISTENTE IMPRESION",jsrender($("#rd-print-alert")),"growl-danger",!0),$(".print-rcn").off("click",t),void $(".print-rcn").on("click",t);x.sendMessage("venta-ultima",null,n)}),$("#ultventa-udp").click(function(e){e.preventDefault(e),$("#tk-last").html('<i class="fa fa-spinner fa-spin"></i>'),x.sendMessage("venta-ultima",null,ultimaVenta)}),$("#vnt-repetir").submit(function(e){e.preventDefault(e);var t,n,o=formControls(this);Me.length=0;const r="object"==typeof o.numero?o.numero:[o.numero];for(var a=0;a<r.length;a++){const e=o.sorteo[a]||o.sorteo,i=o.monto[a]||o.monto;t=findBy("sorteoID",e,B);const s=K[t.sorteo];n=s.find(e=>e.n==r[a]),n?Me.push({numero:n.id,monto:i,sorteoID:e}):notificacion("NUMERO INVALIDO","El numero #"+r[a]+" NO EXISTE EN SORTEO SELECCIONADO","growl-danger")}j(),$("#md-repetir").modal("hide")}),$("#repetir").submit(function(e){e.preventDefault(e);var t=formControls(this),n=formLock(this);x.sendMessage("venta-repetir",t,function(e,t){formReset(n),je=t,t[0].h=1;for(var o=1;o<t.length;o++)t[o].sorteoID!=t[o-1].sorteoID&&(t[o].h=1);$("#vnt-repetir").html(jsrender($("#rd-repetir"),t,Fe)),$("#md-repetir").modal("show")})}),$("#md-repetir").on("shown.bs.modal",function(e){var t=B.filter(o);t=t.sort(U);var n=$(".s2sorteos");n.html(jsrender($("#rd-sorteo-option"),t)),select2w(n);var r=$(".rpt-plus"),a=$(".rpt-minus");t.forEach(function(e,t){$(".srt"+e.sorteoID).select2("val",e.sorteoID)}),r.click(function(){var e=parseInt($(this).attr("sorteo")),n=(je.length,$("select.srt"+e));n.each(function(e,n){var o=$(this),r=o.val(),a=findIndex("sorteoID",r,t);a<t.length-1&&o.prop("selectedIndex",a+1).change()})}),a.click(function(){var e=parseInt($(this).attr("sorteo")),n=(je.length,$("select.srt"+e));n.each(function(e,n){var o=$(this),r=o.val(),a=findIndex("sorteoID",r,t);a>0&&o.prop("selectedIndex",a-1).change()})})});const Ve=3e5;var Je,He;setInterval(_,Ve),_(),we.html(jsrender($("#rd-elemento-option"),z)),Pe.select2("focus"),$(".select2-input").each(function(e){1==e&&(Je=this.id),0==e&&(He=this.id)}),$(document).on("keydown",ne),$(document).on("keydown",te);var Ze=[re,se,le,ce,de],Qe=$("#vnt-zodiaco"),Xe=[{zID:"TODOS",desc:"TODOS"},{zID:"CP",desc:"CAPRICORNIO"},{zID:"AC",desc:"ACUARIO"},{zID:"PI",desc:"PISCIS"},{zID:"AR",desc:"ARIES"},{zID:"TA",desc:"TAURO"},{zID:"GE",desc:"GEMINIS"},{zID:"CN",desc:"CANCER"},{zID:"LE",desc:"LEO"},{zID:"VI",desc:"VIRGO"},{zID:"LI",desc:"LIBRA"},{zID:"ES",desc:"ESCORPION"},{zID:"SA",desc:"SAGITARIO"}];if(Qe.html(jsrender($("#rd-zodiaco-option"),Xe)),n&&n.length>0){var We=n[1]||10,Ye=0,et=0,tt=B.filter(o),nt=(new Date).getTime();function ot(){function e(){$("#bot").html(++et+" de "+We+" ventas confirmadas, con "+Ye.format(2)+" bs"),et<We?ot():$("#bot").append(",en "+((new Date).getTime()-nt)+" ms")}for(var t=getRandomInt(1,tt.length),n=[],o=0;o<t;o++){var r=tt[parseInt(Math.random()*tt.length)],a=K[r.sorteo],i=parseInt(Math.random()*a.length),s={monto:parseFloat(100*getRandomArbitrary(.1,10)),numero:a[i].id,sorteoID:r.sorteoID};Ye+=s.monto,n.push(s)}var l={v:n};"socket"==L.protocolo?x.sendMessage("venta",l,e):b(F,l).then(e)}ot()}}function c(e,t){$("#sorteo-buscar").submit(function(e){e.preventDefault(e);var t=formControls(this),n=formLock(this);x.sendMessage("sorteos",t,function(e,t){formLock(n,!1),$("#sorteos-body").html(jsrender($("#rd-sorteo-row"),t||[]))})})}function d(e,t){
var n,o,r=0,a=0,i=0,s=$("#reporte-fecha"),l={sorteo:function(e){var t=findBy("sorteoID",e,B);return t?t.descripcion:padding(e,6)},format:formatNumber};if($("#reporte").submit(function(e){e.preventDefault(e),o=formControls(this);var t=formLock(this);x.sendMessage("reporte-diario",o,function(e,o){formLock(t,!1),n=o||[],r=0,a=0,i=0,n.forEach(function(e){r+=e.jugado,a+=e.pago,i+=e.premio}),$("#mnt-jugado").html(r.format(2)),$("#mnt-premios").html(i.format(2)),$("#mnt-pagos").html(a.format(2)),$("#mnt-balance").html((r-i).format(2)),$("#mnt-pendiente").html((i-a).format(2)),$("#mnt-ppagos").html((a/i*100).format(2)),$("#reporte-body").html(jsrender($("#rd-reporte-diario"),o,l))})}),$("#print-reporte").click(function(){var e=new Date,t=[{type:"linea",text:G.nombre,align:"center"},{type:"linea",text:e.format("dd/mm/yy")+" "+e.format("TZ:240 h:MM:s TT"),align:"center"},{type:"linea",text:"REPORTE DIARIO",align:"center"}];t.push({type:"linea",text:"FECHA: "+o.fecha,align:"left"}),t.push({type:"linea",text:"JUGADO: "+r.format(2),align:"left"}),t.push({type:"linea",text:"PREMIOS: "+i.format(2),align:"left"}),t.push({type:"linea",text:"PAGOS: "+a.format(2),align:"left"}),t.push({type:"linea",text:"PENDIENTE: "+(i-a).format(2),align:"left"}),t.push({type:"linea",text:"BALANCE: "+(r-i).format(2),align:"left"}),t.push({type:"linea",text:" ",align:"left"}),q.sendMessage("print",{data:t,printer:1})}),t&&1==t.length){var c=t[0].split("-");s.datepicker("setDate",new Date(c[0],parseInt(c[1])-1,c[2])),$("#reporte").trigger("submit")}}function m(e,t){function n(){r=0,a=0,i=0,s=0,l=0,$(".clr-val").html("--"),$("#reporte-body").html(""),o.forEach(function(e){e.balance=e.jugada-(0==c.val()?e.pago:e.premio),l+=e.balance,r+=e.jugada,a+=e.pago,i+=e.premio,s+=e.comision}),$("#mnt-jugado").html(r.format(2)),$("#mnt-premios").html(i.format(2)),$("#mnt-pagos").html(a.format(2)),$("#mnt-balance").html((l-s).format(2)),$("#comision").html(s.format(2)),$("#mnt-neto").html(l.format(2)),0!=o.length&&(0==c.val()?$("#reporte-body").html(jsrender($("#rd-reporte-diario"),o,te)):$("#reporte-body").html(jsrender($("#rd-reporte-diario2"),o,te)))}var o,r,a,i,s,l,c=$("#prm-select");$("#reporte").submit(function(e){e.preventDefault(e);var t=formLock(this),r=formControls(this);x.sendMessage("reporte-general",r,function(e,r){formLock(t,!1),o=r||[],n()})}),c.change(n),$("#print-reporte").click(function(){var e=new Date;o.forEach(function(e){e.desc=e.descripcion.substr(-8)});var t=[{type:"linea",text:G.nombre,align:"center"},{type:"linea",text:e.format("yy-mm-dd")+" "+e.format("TZ:240 h:MM:s TT"),align:"center"},{type:"linea",text:"REPORTE GENERAL",align:"center"}];t.push({type:"linea",text:o[0].descripcion+" - "+o[o.length-1].descripcion,align:"center"}),0==c.val()?(t.push({type:"linea",text:"**PREMIOS PAGADOS**",align:"center"}),i=a,t.push({type:"tabla",data:o,header:!0,columns:[{text:"FECHA",field:"desc",width:25},{text:"JUGADO",field:"jugada",width:25},{text:"PREMIO",field:"pago",width:25},{text:"BALANCE",field:"balance",width:25}]})):t.push({type:"tabla",data:o,header:!0,columns:[{text:"FECHA",field:"desc",width:25},{text:"JUGADO",field:"jugada",width:25},{text:"PREMIO",field:"premio",width:25},{text:"BALANCE",field:"balance",width:25}]}),t.push({type:"linea",text:" ",align:"left"}),t.push({type:"linea",text:"JUGADO: "+r.format(2),align:"left"}),t.push({type:"linea",text:"PREMIOS: "+i.format(2),align:"left"}),t.push({type:"linea",text:"COMISION: "+s.format(2),align:"left"}),t.push({type:"linea",text:"BALANCE: "+(r-i-s).format(2),align:"left"}),t.push({type:"linea",text:" ",align:"left"}),q.sendMessage("print",{data:t,printer:1})})}function p(e,t){function n(e){e.preventDefault(e);const t=formControls(a);sqlAPISocket("2e1dd9aed9c21e58f649de33fc56c006",t,x).then(e=>{r.html(jsrender(o,e))})}const o=$("#rd-reporte"),r=$("#reporte-body"),a=$("#reporte");a.submit(n)}function f(e,t){var n=$("#reporte-fecha");n.change(function(e){x.sendMessage("sorteos",{nombres:e.target.value},function(e,t){$("#sorteos").html(jsrender($("#rd-sorteo-option"),t))})}),n.trigger("change"),$("#reporte").submit(function(e){e.preventDefault(e);var t=formControls(this),n=formLock(this);$("#reporte-vnt").html(""),$("#reporte-elm").html(""),x.sendMessage("reporte-sorteo",t,function(e,t){formLock(n,!1),t.vnt=t.vnt||[];var o=0,r=0,a=0,i=0,s=0;t.vnt.forEach(function(e){0==e.anulado&&(o+=e.monto,r+=e.premio,a+=e.pago>0?e.premio:0,e.premio>0&&i++,e.pago>0&&s++,1==e.anulado&&0)}),$("#mnt-jugado").html(o.format(2)),$("#mnt-premios").html(r.format(2)),$("#mnt-pagos").html(a.format(2)),$("#tk-total").html(t.vnt.length),$("#tk-premios").html(i),$("#tk-pagos").html(s),$("#reporte-vnt").html(jsrender($("#rd-reporte-vnt"),t.vnt)),$(".fticket").click(function(){var e=$("#md-ticket"),t=$(this).data("id");e.on("shown.bs.modal",function(n){e.off("shown.bs.modal",arguments.callee);var o=$("#md-pagar-ticket");o.val(parseInt(t)),o.focus()}),e.modal("show")})})}),t&&t.length}function u(e,t){function n(){u.html(""),h.html(""),$(".es-reset").html("--"),v=1,I=0}function o(e,t){t.data&&(s.push(t.data),g=g.concat(t.data),a(t.data),h.append('<button class="btn btn-default nav-btn">'+ ++v+"</button>")),t.last&&(x.removeListener("reporte-ventas",o),$(".nav-btn").click(function(){var e=$(this);I=parseInt(e.html())-1,e.hasClass("btn-default")&&($(".nav-btn").switchClass("btn-primary","btn-default"),e.switchClass("btn-default","btn-primary"),r(s[I]))}))}function r(e){function t(){i.off("shown.bs.modal",t);var e=$("#md-pagar-ticket");e.val(parseInt(n)),e.focus()}let n;u.html(jsrender($("#rd-reporte-diario"),e)),$(".fticket").click(function(){n=$(this).data("id"),i.on("shown.bs.modal",t),i.modal("show")})}function a(e){if(e){e.forEach(function(e){0==e.a?(l+=e.m,c+=e.pg,d+=e.pr):(m++,p+=e.m)});var t=l*G.comision*.01;$("#mnt-jugado").html(l.format(2)),$("#mnt-premios").html(d.format(2)),$("#mnt-pagos").html(c.format(2)),$("#mnt-balance").html((l-d-t).format(2)),$("#mnt-comision").html(t.format(2)),$("#mnt-pendiente").html((d-c).format(2)),$("#mnt-ppagos").html((c/d*100).format(2)),$("#mnt-tanulados").html(m.format(2)),$("#mnt-anulados").html(p.format(2))}}const i=$("#md-ticket");var s,l=0,c=0,d=0,m=0,p=0,f=$("#reporte-fecha"),u=$("#reporte-body"),h=$("#nav-table"),g=[];$("#rpt-vpremio").click(function(){var e=g.filter(function(e){return e.pr>0});r(e),$(".nav-btn").addClass("disabled")}),$("#rpt-vjugado").click(function(){r(s[I]),$(".nav-btn").removeClass("disabled")}),$("#rpt-vanulado").click(function(){var e=g.filter(function(e){return e.a>0});r(e),$(".nav-btn").addClass("disabled")}),$("#rpt-vpend").click(function(){var e=g.filter(function(e){return e.pg<e.pr});r(e),$(".nav-btn").addClass("disabled")}),$("#rpt-vpagos").click(function(){var e=g.filter(function(e){return e.pg>0});r(e),$(".nav-btn").addClass("disabled")}),$("#reporte").submit(function(e){e.preventDefault(e),g.length=0,l=0,c=0,d=0,m=0,p=0;var t=formControls(this),i=formLock(this);n(),x.sendMessage("reporte-ventas",t,function(e,t){t.last||x.addListener("reporte-ventas",o),g=t.data||[],formLock(i,!1),t.data&&(s=[t.data],a(t.data),r(t.data),h.html('<button class="btn btn-primary nav-btn">1</button>'))})});var v=1,I=0;if($("#print-reporte").click(function(){var e=new Date,t=[{type:"linea",text:G.nombre,align:"center"},{type:"linea",text:e.format("yy-mm-dd")+" "+e.format("TZ:240 h:MM:s TT"),align:"center"},{type:"linea",text:"REPORTE TICKETS",align:"center"}];t.push({type:"linea",text:"JUGADO: "+l.format(2),align:"left"}),t.push({type:"linea",text:"PREMIOS: "+d.format(2),align:"left"}),t.push({type:"linea",text:"PAGOS: "+c.format(2),align:"left"}),t.push({type:"linea",text:"PENDIENTE: "+(d-c).format(2),align:"left"}),t.push({type:"linea",text:"BALANCE: "+(l-c).format(2),align:"left"}),t.push({type:"linea",text:" ",align:"left"}),q.sendMessage("print",{data:t,printer:1})}),t&&1==t.length){var E=t[0].split("-");f.datepicker("setDate",new Date(E[0],parseInt(E[1])-1,E[2])),$("#reporte").trigger("submit")}}function h(t,n){var o=$("#md-impresion"),r=$("#ft-impresion"),a=$("#lt-linea"),i=$("#md-orden"),s=$("#md-intefaz");s.change(function(t){var n=s.val();e(CONFIG.INTERFAZ_MODO,n)}),s.select2("val",L.modoInterfaz||"ventamax"),s.val(L.modoInterfaz||"ventamax"),o.change(function(t){e(CONFIG.IMPRIMIR_MODO,o.val())}),o.select2("val",L.modoImpresion||1),o.val(L.modoImpresion||1),r.change(function(t){e(CONFIG.IMPRIMIR_FORMATO,r.val())});var l=L.formatoImpresion;r.select2("val",l||0),r.val(l||0),a.val(L.letrasLinea),$("#btnletras").click(function(){e(CONFIG.IMPRIMIR_LETRASxLINEA,a.val()),notificacion("Letras Linea","Cambio exitoso")}),i.select2("val",L.ordenSorteos||0),i.val(L.ordenSorteos),i.change(function(t){e(CONFIG.SORTEOS_ORDEN,i.val())}),$("#prf-ticketPrueba").click(function(e){var t=[[{type:"linea",text:"AG. DEMO",align:"center"},{type:"linea",text:"04/06/17 06:12:14 AM",align:"center"},{type:"linea",text:"9999999-1234",align:"center"},{type:"linea",text:"TICKET PRUEBA",align:"center"},{type:"linea",text:"RULETA ACTIVA 10AM",align:"center"},{type:"linea",text:"#0\t DELFIN\t 99999",align:"center"},{type:"linea",text:"#01\t CARNERO\t 99999",align:"center"},{type:"linea",text:"#02\t TORO\t 99999",align:"center"},{type:"linea",text:"#03\t CIEMPIES\t 99999",align:"center"},{type:"linea",text:"#04\t ALACRAN\t 99999",align:"center"},{type:"linea",text:"#05\t LEON\t 99999",align:"center"},{type:"linea",text:"#06\t RANA\t 99999",align:"center"},{type:"linea",text:"#07\t PERICO\t 99999",align:"center"},{type:"linea",text:"#08\t RATON\t 99999",align:"center"},{type:"linea",text:"#09\t AGUILA\t 99999",align:"center"},{type:"linea",text:"TOTAL: 999990",align:"center"},{type:"linea",text:"CADUCA EN 3 DIAS",align:"center"},{type:"linea",text:"c8dda1ff1abe1e7ddd1042a2213b3da0",align:"center"},{type:"linea",text:" ",align:"left"}],[{type:"linea",text:"AG. DEMO",align:"center"},{type:"linea",text:"04/06/17 06:12:14 AM",align:"center"},{type:"linea",text:"9999999-1234",align:"center"},{type:"linea",text:"TICKET PRUEBA",align:"center"},{type:"tabla",header:!1,columns:[{field:"l1",text:"RULETA ACTIVA 10AM",width:"50"},{field:"l2",text:" ",width:"50"}],data:[{l1:"0\tDELF\t99999",l2:"01\tCARN\t99999"},{l1:"02\tTORO\t99999",l2:"03\tCIEM\t99999"},{l1:"04\tALAC\t99999",l2:"05\tLEON\t99999"},{l1:"06\tRANA\t99999",l2:"07\tPERI\t99999"},{l1:"08\tRATO\t99999",l2:"09\tAGUI\t99999"}]},{type:"linea",text:"TOTAL: 999990",align:"center"},{type:"linea",text:"CADUCA EN 3 DIAS",align:"center"},{type:"linea",text:"c8dda1ff1abe1e7ddd1042a2213b3da0",align:"center"},{type:"linea",text:" ",align:"left"}],[{type:"linea",text:"AG. DEMO",align:"center"},{type:"linea",text:"04/06/17 06:12:14 AM",align:"center"},{type:"linea",text:"9999999-1234",align:"center"},{type:"linea",text:"TICKET PRUEBA",align:"center"},{type:"tabla",header:!1,columns:[{field:"l1",text:"RULETA ACTIVA 10AM",width:33},{field:"l2",text:" ",width:33},{field:"l3",text:" ",width:33}],data:[{l1:"0x99999",l2:"01x99999",l3:"02x99999"},{l1:"03x99999",l2:"04x99999",l3:"05x99999"},{l1:"06x99999",l2:"07x99999",l3:"08x99999"},{l1:"09x99999",l2:" ",l3:" "}]},{type:"linea",text:"TOTAL: 999990",align:"center"},{type:"linea",text:"CADUCA EN 3 DIAS",align:"center"},{type:"linea",text:"c8dda1ff1abe1e7ddd1042a2213b3da0",align:"center"},{type:"linea",text:" ",align:"left"}]],n=L.modoImpresion||0;"atm"==n&&(n=2),q.sendMessage("print",{data:t[n],printer:1})});var c=$("#btnimprimir"),d=$("#scimprimir");d.val(getKeyName(L.imprimirTecla)),c.click(function(t){function n(t){$(document).off("keydown",n),t.metaKey||t.preventDefault();var o=getKeyName(t.keyCode);o&&(d.val(o),e(CONFIG.IMPRIMIR_TECLA,t.keyCode)),c.html("Editar")}$(document).on("keydown",n),c.html("Presione una tecla...")}),$("#prf-rest-numeros").click(function(){var e=confirm("Esta accion reinicara el listado de numeros almacenados y reiniciara su sesion");e&&(k.removeItem(CONFIG.ELEMENTOS),k.removeItem(CONFIG.ELEMENTOS_HASH),location.reload())});let m=$("#moneda");$("#monedaOK").click(t=>{e(CONFIG.MONEDA,m.val()),notificacion("Moneda establecida correctamente")}),m.val(L.moneda);let p=$("#clienteNombre");p.select2("val",L.nombreCliente),p.val(L.nombreCliente),p.change(function(t){e(CONFIG.NOMBRE_CLIENTE,p.val())});let f=$("#protocolo");f.select2("val",L.protocolo),f.val(L.protocolo),f.change(function(t){e(CONFIG.PROTOCOLO,f.val())}),n&&n.length>0&&$("html, body").animate({scrollTop:$("#"+n[0]).offset().top},500)}function g(e,t){var n=["#ayuda-venta","#ayuda-pago","#ayuda-anular"];if(t.length>0){var o=t[0];$("html, body").animate({scrollTop:$(n[o]).offset().top},1e3)}}function v(e){x&&(x.removeListener(NetEvent.SOCKET_CLOSE,N),x.removeListener(NetEvent.SOCKET_ERROR,A)),x=new Net("ws://"+S,!1),x.addListener(NetEvent.SOCKET_OPEN,y),x.addListener(NetEvent.LOGIN,T),x.addListener("duplicado",O),x.addListener("close-mant",D),x.addListener(NetEvent.SOCKET_CLOSE,N),x.addListener(NetEvent.SOCKET_ERROR,A),x.addListener("init",I),x.addListener("fingerprint",E),x.addListener(NetEvent.DATA_CHANGE,function(){$("#main-bin").text(Net.parseBytes(x.bytesIn)),$("#main-bout").text(Net.parseBytes(x.bytesOut))}),x.addListener("venta-anular-banca",function(e,t){notificacion("TICKET ANULADO POR BANCA","TICKET #"+t,"growl-success",!0)}),x.addListener("sorteos-update",function(e,t){B=t.sorteos}),x.addListener("estatus-change",function(e,t){var n=t.cierra?"CIERRA":"ABRE",o=findBy("sorteoID",t.sorteoID,B);o&&notificacion("SISTEMA","SORTEO <strong>"+o.descripcion+"</strong> "+n)}),x.addListener("metas",function(e,t){H=t,H.hasOwnProperty("msg_init")&&H.msg_init.length>0&&notificacion("MENSAJE BANCA",H.msg_init,"",!0),H.hasOwnProperty("msg_srv")&&H.msg_srv.length>0&&notificacion("MENSAJE SERVIDOR",H.msg_srv,"",!0)}),x.addListener("elementos-init",function(e,t){t.hasOwnProperty("hash")?(console.log(M),k.setItem(CONFIG.ELEMENTOS_HASH,t.hash),k.setItem(CONFIG.ELEMENTOS,JSON.stringify(M)),K=M,notificacion("Lista de numeros actualizados")):M[t[0].s]=t}),x.connect();var t=$("#pre-timer"),n=0;Q=setInterval(()=>{if(t.html(10-n++),n>10){clearInterval(Q),t.html("");var e=hostAlt;v(e)}},1e3)}function I(e,t){J.hora=t.t,null==k.fpud62737hdh2&&(k.fpud62737hdh2=Z.getFingerprint()),X=k.fpud62737hdh2,W=md5(X.toString()+t.t),ee>0&&clearInterval(ee),ee=setInterval(function(){J.hora+=1e3},1e3);var n=k.getItem("loto_taqlogin");n&&C(JSON.parse(n))}function E(e,t){x.removeListener("fingerprint",E),x.sendMessage(e,X)}function O(e){V.nav("506",null,null,"body"),x.removeListener(NetEvent.SOCKET_CLOSE,N),x.close()}function D(e){V.nav("601",null,null,"body"),x.removeListener(NetEvent.SOCKET_CLOSE,N),x.close()}function y(e){clearInterval(Q),$("#conectando").fadeOut()}function C(e,t){e.fp=W,x.sendMessage("login",e,t)}function A(e){clearInterval(Q);var t=hostAlt;v(t),x.removeListener(NetEvent.SOCKET_CLOSE,N)}function N(e){$("#conectando").fadeIn(),Y=!1,setTimeout(v,3e3)}function T(e,t){function n(e,t){var r=k.getItem(CONFIG.ELEMENTOS_HASH);if(r==e)try{o(),t()}catch(e){n("refres",t)}else notificacion("Espere...",'<p id="ntf-cargaelem"><i class="fa fa-spinner fa-spin"></i> Recibiendo listado animales</p>'),M={},x.sendMessage("elementos-init",null,(e,t)=>{V.navUrl()})}function o(){K=JSON.parse(k.getItem(CONFIG.ELEMENTOS));if(!K){var e=confirm("No hay registrados elementos para los sorteos registrados, desea cargarlos nuevamente?");e&&n("",function(){V.navUrl()})}}t.hasOwnProperty("code")?5==t.code?(V.nav("507",null,null,"body"),k.removeItem("loto_taqlogin"),x.removeListener(NetEvent.SOCKET_CLOSE,N),x.close()):505==t.code&&notificacion("USUARIO SUSPENDIDO","Comuniquese con su administrador o banquero","growl-danger"):(G=t.taq,F=t.sesion,$(".username").html(G.nombre),B=t.sorteos,J.hora=t.time,n(t.elementos,function(){V.navUrl()}))}function b(e,t){return new Promise((n,o)=>{t=JSON.stringify(t);const r=$.cookie("api")||"127.0.0.1:4025";$.get(`http://${r}/taq/venta?${encodeURI(`sesion=${e}&data=${t}`)}`,function(e){n(e)})})}var x,k=localStorage,R=sessionStorage.getItem("ruta"),S=R||$.cookie("taquilla")||location.hostname+":4022",L={modoImpresion:k.getItem(CONFIG.IMPRIMIR_MODO)||1,imprimirTecla:k.getItem(CONFIG.IMPRIMIR_TECLA)||107,formatoImpresion:k.getItem(CONFIG.IMPRIMIR_FORMATO)||0,letrasLinea:k.getItem(CONFIG.IMPRIMIR_LETRASxLINEA)||25,ordenSorteos:k.getItem(CONFIG.SORTEOS_ORDEN)||0,modoInterfaz:k.getItem(CONFIG.INTERFAZ_MODO)||"ventamax",moneda:k.getItem(CONFIG.MONEDA)||"",nombreCliente:k.getItem(CONFIG.NOMBRE_CLIENTE)||0,protocolo:k.getItem(CONFIG.PROTOCOLO)||"socket"},M={};$("#rutaAlt").click(e=>{e.preventDefault();let t=$(e.target).attr("url");sessionStorage.setItem("ruta",t),location.reload()});var w,P=!1,q=new Net("ws://127.0.0.1:9999",!1);q.addListener(NetEvent.SOCKET_OPEN,function(e){P=!0,notificacion("ASISTENTE IMPRESION","CONEXION EXITOSA","growl-success")}),q.addListener(NetEvent.SOCKET_CLOSE,function(e){P=!!Z.isMobile(),0==L.formatoImpresion&&0==Z.isMobile()&&(w=notificacion("ASISTENTE IMPRESION",jsrender($("#rd-print-alert")),"growl-danger",!0),$(".print-rcn").off("click",t),$(".print-rcn").on("click",t))}),q.connect();let j=$("#ws-send"),_=JSON.parse(k.getItem("srqtaq.ws.enviados"))||[],U=JSON.parse(k.getItem("srqtaq.ws.banned"))||[];$("#ws-count").html(_.length);for(let e=0;e<U.length;e++){const t=U[e],n=(new Date).getTime();n>t.hasta&&(U.splice(e,1),k.setItem("srqtaq.ws.banned",JSON.stringify(U)))}j.submit(function(e){function t(e){$("#wsban-alert").addClass("hidden")}e.preventDefault(e);let o=formControls(this);for(let e=0;e<U.length;e++){const n=U[e];if(n.numero==o.numero)return $("#wsban-alert").removeClass("hidden"),void setTimeout(t,5e3)}n(o.numero,o.mensaje),$("#wsban-alert").addClass("hidden"),j[0].reset()}),setInterval(()=>{for(let e=_.length-1;e>=0;e--){const t=_[e];fetch(`http://104.129.171.151:3000/msg/${t._id}`).then(e=>e.json()).then(t=>{t.hasOwnProperty("error")?(_.splice(e,1),notificacion("Whatsapp",`<p>Mensaje NO enviado<br>Razon: Numero Incorrecto o No Existe</p><p>Numero: ${t.numero}</p>`,"growl-danger"),k.setItem("srqtaq.ws.enviados",JSON.stringify(_)),U.push({numero:t.numero,hasta:(new Date).getTime()+6e4}),k.setItem("srqtaq.ws.banned",JSON.stringify(U))):t.hasOwnProperty("enviado")&&(_.splice(e,1),notificacion("Whatsapp",`<p>Mensaje enviado</p><p>Numero: ${t.numero}</p>`,"growl-success"),k.setItem("srqtaq.ws.enviados",JSON.stringify(_))),$("#ws-count").html(_.length)})}},5e3);var G,F,K,B,z,V=new Navegador;V.folder="paginas",V.viewport=".contentpanel",V.validate=function(e,t){return"507"==e?e:G?e:"login"};var J={},H={},Z=new ClientJS;V.paginas.addListener(Navegador.ENTER,function(e,t){var n=jQuery(".mainpanel"),o=jQuery(document).height(),r=n.height();o>r&&n.height(o),select2w($(".s2"),{hideSelectionFromResult:function(e){return!0},placeholder:"Seleccione...",language:"es"}),$(".date").datepicker({dateFormat:"yy-mm-dd"}),$(".now").datepicker("setDate",new Date)}),V.paginas.addListener(Navegador.COMPLETE,function(e,t){var n=jQuery(".panel-heading");n.attr("title","Click para expandir y/o contraer panel"),n.click(function(){var e=jQuery(this).find(".minimize"),t=e.closest(".panel");return e.hasClass("maximize")?(t.find(".panel-body, .panel-footer").slideDown(200),e.removeClass("maximize"),e.html("&minus;")):(t.find(".panel-body, .panel-footer").slideUp(200),e.addClass("maximize"),e.html("&plus;")),!1}),jQuery(".panel .panel-close").click(function(){return jQuery(this).closest(".panel").fadeOut(200),!1})}),V.paginas.addListener("login",function(e,t){$("#login-form").submit(function(e){e.preventDefault(e);var t=formControls(this),n=formLock(this);C(t,function(e,o){if(formLock(n,!1),o.hasOwnProperty("code"))2==o.code&&notificacion("CLAVE INVALIDA");else{var r=$("#recordar").is(":checked");r?k.setItem("loto_taqlogin",JSON.stringify(t)):k.removeItem("loto_taqlogin")}})})}),V.paginas.addListener("inicio",function(e,t){function n(){var e=V.current().page;"inicio"==e?($("#servidor-tiempo").html(dateFormat(J.hora,"TZ:240 dd/mm/yy hh:MM TT")),B.forEach(function(e){e.abierta&&e.cierra>J.hora?$("#srt-resta-"+e.sorteoID).html(msToString(e.cierra-J.hora)):$("#srt-resta-"+e.sorteoID).html("<label class='label label-danger'>CERRADO</label>")})):clearInterval(o)}var o,r={gano:function(e,t){if(0==e)return"";{const n=B.find(e=>e.sorteoID==t),o=K[n.sorteo];if(o){const t=o.find(t=>t.id==e);return t?t.d:"NA"}return""}},formatDate:dateFormat};$("#pagina-tiulo").html('<i class="fa fa-home"></i> Bienvenido, '+G.nombre),B&&(o=setInterval(n,6e4),$("#sorteos-body").html(jsrender($("#rd-inicio-sorteos-row"),B,r)),n())}),V.paginas.addListener("venta",l),V.paginas.addListener("ventamax",l),V.paginas.addListener("visual",l),V.paginas.addListener("visual",(e,t)=>{function n(e){if(e.keyCode>=95&&e.keyCode<=105){let t=e.key;e.ctrlKey&&(s+=t,clearTimeout(i),i=setTimeout(()=>{$("#vnt-numeros").val(s),$("#md-montoVenta").modal(),s=""},2e3))}}function o(e){return e<10?`0${e}`:e.toString()}let r=$("#montoAnimal"),a=$("#md-montoVenta");a.on("shown.bs.modal",()=>{$("#md-montoInput").focus(),$("#md-montoInput").select()}),$(document).on("keydown",n);let i,s="";r.submit(function(e){e.preventDefault(e);let t=formControls(this);$("#vnt-monto").val(t.monto),$("#vnt-venta").trigger("submit"),a.modal("hide")});let l=$("#numpanel");for(let e=0;e<=36;e++)0==e&&l.append('<div class="numcell" numero="0"><img src="/assets/animales/0.jpg" class="numero"/><div class="overlay"></div></div>'),l.append(`<div class="numcell" numero="${o(e)}"><img src="/assets/animales/${o(e)}.jpg" class="numero"/><div class="overlay"></div></div>`);$(".numcell").click(function(e){let t=$(this).attr("numero");$("#vnt-numeros").val(t.toString()),$("#md-montoVenta").modal()})});var Q,X,W,Y=!1;V.paginas.addListener("sorteos/buscar",c),V.paginas.addListener("reporte/diario",d),V.paginas.addListener("reporte/general",m),V.paginas.addListener("reporte/operadoras",p),V.paginas.addListener("reporte/sorteo",f),V.paginas.addListener("reporte/ventas",u),V.paginas.addListener("preferencias",h),V.paginas.addListener("ayuda",g),v();var ee=0;$("#logolink").click(function(){location.reload(!0)}),$("#vnt-anular").submit(function(e){e.preventDefault(e);var t=formControls(this),n=formLock(this);setTimeout(function(){formLock(n,!1)},2e3),x.sendMessage("venta-anular",t,function(e,o){formReset(n),o.hasOwnProperty("code")?2==o.code?notificacion("TICKET NO EXISTE"):4==o.code?notificacion("TICKET YA SE ENCUENTRA ANULADO"):5==o.code&&notificacion("TICKET INVALIDO","TICKET CADUCADO"):($("#md-anularTicket").modal("hide"),notificacion("TICKET ANULADO","TICKET #"+t.ticketID,"growl-success"))})}),$("#md-anularTicket").on("shown.bs.modal",function(e){var t=$("#md-anular-ticket");t.val(""),t.focus()});var te={formatDate:dateFormat,formatNumber:formatNumber,padding:padding};$("#vnt-pagar").submit(function(e){e.preventDefault(e);var t=formControls(this),n=formLock(this);x.sendMessage("venta-premios",t,function(e,t){formLock(n,!1),t.hasOwnProperty("code")?notificacion("TICKET NO EXISTE",""):(t.prm,$("#md-pagar-tpremio").html(jsrender($("#rd-premio-ticket"),[t.tk])),$("#md-pagar-prms").html(jsrender($("#rd-premio-premios"),t.prm,te)),$(".pagar-premio").click(function(e){var n=$(e.target),o=n.data("id"),r=n.data("ticket"),a=n.data("sorteoid"),i=findBy("ventaID",o,t.prm).premio,s=parseInt($("#md-pagar-codigo").val());n.prop("disabled",!0),x.sendMessage("venta-pagar",{id:o,tk:r,cod:s,sorteoID:a,premio:i},function(e,t){t.hasOwnProperty("code")?(notificacion("#"+r+": PAGO NO PROCESADO","CODIGO INVALIDO o TICKET EXPIRO","growl-danger"),n.prop("disabled",!1)):n.html('<i class="fa fa-check"></i>')})}),$("#anulado-timestamp").click(function(e){e.preventDefault(e);var t=$(this).attr("ticketID");x.sendMessage("ticket-anulado",{ticketID:t},function(e,t){t.hasOwnProperty("code")?notificacion("ERROR AL LEER HORA DE ANULACION"):$("#anulado-labelstamp").html('SI <i class="fa fa-clock-o"></i> '+t.tiempo)})}))})});var ne=$("#md-ticket");ne.on("shown.bs.modal",function(e){var t=$("#md-pagar-ticket");t.val(""),t.focus()}),ne.on("hidden.bs.modal",function(e){$("#md-pagar-ticket").val(""),$("#md-pagar-codigo").val("0"),$("#md-pagar-tpremio").html(""),$("#md-pagar-prms").html("")}),V.navUrl(),$(".logout").click(function(e){e.preventDefault(e),G=null,$(".username").html("Usuario"),localStorage.removeItem("loto_taqlogin"),V.nav("inicio")})};init();