function login_nav(e,o){$("#login-form").submit(function(e){e.preventDefault(e);var o=formControls(this);socket.sendMessage("login",o,function(e,t){var r=$("#recordar").is(":checked");r&&localStorage.setItem("srq_lot_prm_login",JSON.stringify(o))})})}function inicio_nav(e,o){var t=copyTo(_helpers);t.ganador=function(e){var o=findBy("elementoID",e,$elementos);return o?"#"+o.numero+" "+o.descripcion:""},socket.sendMessage("inicio",null,function(e,o){o.hasOwnProperty("code")||$("#srt_dia").html(jsrender($("#rd-sorteos-dia-row"),o.data,t)),$("#str-dia-stamp").html(new Date(o.time).format("hh:MM TT"))})}function sorteoBuscar_nav(e,o){function t(){var e=$("#buscar-sorteos"),o=uniqueVal(n,"sorteo"),t=[];o.forEach(function(e){t.push(findBy("sorteoID",e.sorteo,$sorteos))}),e.html(jsrender($("#rd-operadora-option"),t)),e.select2("val",""),e.val(""),e.select2("open"),$(".bfiltro").change(function(){e.trigger("change")}),e.change(function(e){function o(){var e=$("#srt-abr").val(),o=$("#srt-prm").val(),s=$("#srt-flt").val(),i=a.filter(function(t){var r,n;return 0==s||(r=1==e?1==t.abierta:0==t.abierta,n=1==o?!!t.g:null==t.g,r&&n)});$("#sorteos-body").html(jsrender($("#rd-sorteo-row"),i,r));var c=$(".ttgl");c.each(function(e){var o=$(this);o.toggles({text:{on:"SI",off:"NO"},on:o.data("activa"),click:!0})}),c.on("toggle",function(e,o){var t={sorteo:$(e.target).data("target"),abierta:o};socket.sendMessage("sorteo-editar",t,function(e,o){console.log(e,o)})}),select2w($(".s3"),{allowClear:!0}),$("select.sorteosel").each(function(e,o){var t=$(o).data("select");$(o).val(t),$(o).select2("val",t)}),$(".sorteosel").change(function(e){var o=e.target.value,r=$(this),s=r.data("sorteo"),a=findBy("elementoID",o,$elementos),i=findBy("sorteoID",s,n),c=confirm("Confirma que desea registrar #"+i.sorteoID+" "+i.descripcion+" #"+a.numero+" "+a.descripcion);if(c){var m={sorteoID:s,elemento:o};t(m,r)}else r.select2("val",r.data("select")),r.val(r.data("select"))})}function t(e,o){socket.sendMessage("sorteo-premiar",e,function(r,n){var s;if(1==n.code)s=findBy("elementoID",e.elemento,$elementos),notificacion("SORTEO PREMIADO","SORTEO #"+e.sorteoID+" PREMIADO<p>GANADOR: #"+s.numero+" "+s.descripcion+"</p>");else if(0==n.code)s=findBy("elementoID",e.elemento,$elementos),notificacion("[JV] SOLICITUD ACEPTADA","SORTEO #"+e.sorteoID+"<p>GANADOR: #"+s.numero+" "+s.descripcion+"</p>");else if(4==n.code){notificacion("SORTEOS","SORTEO #"+e.sorteoID+" YA ESTA PREMIADO","growl-danger");var a=confirm("Este sorteo ya esta premiado, desea reiniciarlo");a?socket.sendMessage("sorteo-reiniciar",{sorteoID:e.sorteoID},function(r,n){notificacion("SORTEOS","SORTEO #"+e.sorteoID+" REINICIADO SATISFACTORIAMENTE"),confirm("DESEA VOLVER A PREMIAR CON EL NUMERO SELECCIONADO?")&&t(e,o)}):(o.select2("val",o.data("select")),o.val(o.data("select")))}else 3==n.code?notificacion("SORTEOS","SORTEO #"+e.sorteoID+" PREMIADO, PERO SIN VENTAS REGISTRADAS","growl-danger"):5==n.code&&notificacion("SORTEO ABIERTO"," SORTEO #"+e.sorteoID+" AUN ESTA ABIERTO","growl-danger")})}var s=e.target.value,a=exploreBy("sorteo",s,n),i=findBy("sorteo",s,$elementos);i?o():socket.sendMessage("elementos",{sorteo:s},function(e,t){$elementos=$elementos?$elementos.concat(t):t,o()})})}var r={padding:padding,sorteos:function(e){for(var o="",t=exploreBy("sorteo",e,$elementos),r=0;r<t.length;r++)o+='<option value="'+t[r].elementoID+'">#'+t[r].numero+" "+t[r].descripcion+"</option>";return o}},n=[],s=$(".tgl");s.each(function(e){var o=$(this);o.toggles({text:{on:"SI",off:"NO"},on:o.data("activo"),click:!0})}),s.on("toggle",function(e,o){t()}),$("#srt-flt").change(function(e){var o=$(this).val();0==o?$("#flt-alerta").addClass("hidden"):$("#flt-alerta").removeClass("hidden")}),$("#sorteo-buscar").submit(function(e){e.preventDefault(e);var o=formControls(this),r=formLock(this);socket.sendMessage("sorteos",o,function(e,o){formLock(r,!1),n=o||[],t()})})}function sorteoPremiar_nav(){function e(e){socket.sendMessage("sorteos",{lista:e},function(e,o){t=o||[];var r=$("#premiar-sorteo");r.html(jsrender(s,t)),r.select2("val",""),r=$("#reiniciar-sorteo"),r.html(jsrender(s,t)),r.select2("val","")})}function o(e){var o=findBy("sorteoID",e,t);n.html(jsrender(a,exploreBy("sorteo",o.sorteo,$elementos)))}var t,r=$("#premiar-sorteo"),n=$("#premiar-numero"),s=$("#rd-sorteo-option"),a=$("#rd-elemento-option");$(".date").on("change",function(o){e(o.target.value)}),r.on("change",function(){o(r.val())}),$("#premiar-form").submit(function(e){e.preventDefault(e);var o=formControls(this),t=formLock(this);socket.sendMessage("sorteo-premiar",o,function(e,r){var n;formLock(t,!1),1==r.code?(n=findBy("elementoID",o.elemento,$elementos),notificacion("SORTEO PREMIADO","SORTEO #"+o.sorteoID+" PREMIADO<p>GANADOR: #"+n.numero+" "+n.descripcion+"</p>")):0==r.code?(n=findBy("elementoID",o.elemento,$elementos),notificacion("[JV] SOLICITUD ACEPTADA","SORTEO #"+o.sorteoID+" PREMIADO<p>GANADOR: #"+n.numero+" "+n.descripcion+"</p>")):4==r.code?notificacion("SORTEOS","SORTEO #"+o.sorteoID+" YA ESTA PREMIADO","growl-danger"):3==r.code?notificacion("SORTEOS","SORTEO #"+o.sorteoID+" PREMIADO, PERO SIN VENTAS REGISTRADAS","growl-danger"):5==r.code&&notificacion("SORTEO ABIERTO"," SORTEO #"+o.sorteoID+" AUN ESTA ABIERTO","growl-danger")})}),$("#reiniciar-form").submit(function(e){e.preventDefault(e);var o=confirm("Seguro desea reiniciar premio?");if(1==o){var t=formControls(this),r=formLock(this);socket.sendMessage("sorteo-reiniciar",t,function(e,o){formLock(r,!1),notificacion("SORTEOS","SORTEO #"+t.sorteoID+" REINICIADO SATISFACTORIAMENTE")})}});var i=(new Date).format();e(i)}function sorteoMonitor_nav(e,o){function t(){$("#numeros-body").html(jsrender($("#rd-vtnum-row"),l.n,O)),$(".mnt-historial").click(function(e){e.preventDefault(e);var o=$(this).attr("n"),t={dateDif:dayLeft};socket.sendMessage("sorteo-num-hist",{n:o},function(e,r){var n=findBy("n",o,l.n);$("#md-hnum").html(n.numero+" "+n.desc),$("#md-historia-body").html(jsrender($("#rd-num-row"),r,t)),$("#md-numhist").modal()})}),$(".mnt-vnt-tickets").click(function(e){e.preventDefault(e);var o=$(this).attr("n");socket.sendMessage("sorteo-monitor-vnt",{numero:o,sorteo:a.sorteoID},function(e,t){function n(e,o,t){t=null==t||t;var r,n=[],s=[],a=e.length;for(r=0;r<a;r++)n[e[r][o]]||(n[e[r][o]]=!0,t?s.push(e[r]):s.push(e[r][o]));return s}if(null!=t){c=t;var s=n(t,"us"),a=n(t,"bc"),i=n(t,"tq");s.unshift({us:0,usn:"TODAS"}),a.unshift({bc:0,bnc:"TODAS"}),i.unshift({tq:0,tqn:"TODAS"});var m=$("#mnt-ventas-us"),d=$("#mnt-ventas-bc"),u=$("#mnt-ventas-tq");m.html(jsrender($("#rd-us-option"),s)),m.select2("val",0),d.html(jsrender($("#rd-bn-option"),a)),d.select2("val",0),u.html(jsrender($("#rd-tq-option"),i)),u.select2("val",0),$("#md-tickets-body").html(jsrender($("#rd-num-ticket"),t)),r(t);var f=findBy("n",o,l.n);$("#md-tnum").html(f.numero+" "+f.desc),$("#md-tktable").css("max-height","400px"),$("#md-numventas").modal()}else notificacion("NO HAY TICKETS DISPONIBLES")})}),$(".mnt-vnt-itickets").click(function(e){e.preventDefault(e);var o=$(this).attr("n");intsocket.sendMessage("sorteo-monitor-vnt",{numero:o,sorteo:p},function(e,t){function n(e,o,t){t=null==t||t;var r,n=[],s=[],a=e.length;for(r=0;r<a;r++)n[e[r][o]]||(n[e[r][o]]=!0,t?s.push(e[r]):s.push(e[r][o]));return s}if(null!=t){c=t;var s=n(t,"us"),a=n(t,"bc"),i=n(t,"tq");s.unshift({us:0,usn:"TODAS"}),a.unshift({bc:0,bnc:"TODAS"}),i.unshift({tq:0,tqn:"TODAS"});var m=$("#mnt-ventas-us"),l=$("#mnt-ventas-bc"),d=$("#mnt-ventas-tq");m.html(jsrender($("#rd-us-option"),s)),m.select2("val",0),l.html(jsrender($("#rd-bn-option"),a)),l.select2("val",0),d.html(jsrender($("#rd-tq-option"),i)),d.select2("val",0),$("#md-tickets-body").html(jsrender($("#rd-num-ticket"),t)),r(t);var u=findBy("n",o,h);$("#md-tnum").html(u.numero+" "+u.desc),$("#md-tktable").css("max-height","400px"),$("#md-numventas").modal()}else notificacion("NO HAY TICKETS DISPONIBLES")})}),i.forEach(function(e,o){$("#rn"+e.gid).removeClass("hidden")}),$(".mnt-prm").on("click",function(e){e.preventDefault(e);var o=parseInt($(this).attr("num")),t={sorteoID:a.sorteoID,elemento:o};s(t,e)})}function r(e){e||alert("No hay tickets que mostrar"),$("#md-ntickets").html(e.length);for(var o=0,t=0;t<e.length;t++)o+=e[t].m;$("#md-mtickets").html(o.format(2)),$(".fticket").click(function(e){e.preventDefault(e);var o=$("#md-ticket"),t=parseInt($(this).attr("tid"));o.on("shown.bs.modal",function(e){o.off("shown.bs.modal",arguments.callee);var r=$("#md-pagar-ticket");r.val(parseInt(t)),r.focus()}),o.on("hidden.bs.modal",function(e){o.off("hidden.bs.modal",arguments.callee),$("#md-numventas").modal("show")}),$("#md-numventas").modal("hide"),o.modal("show")})}function n(e){socket.sendMessage("sorteos",{lista:e},function(e,t){i=t||[];var r=$("#ssorteos");if(r.html(jsrender($("#rd-sorteo-option"),t)),r.select2("val",""),o&&o.length>1){var n=parseInt(o[1]);r.prop("selectedIndex",n).change(),$("#monitor-form").submit()}})}function s(e,o){socket.sendMessage("sorteo-premiar",e,function(r,a){var i;if(1==a.code)i=findBy("elementoID",e.elemento,$elementos),notificacion("SORTEO PREMIADO","SORTEO #"+e.sorteoID+" PREMIADO<p>GANADOR: #"+i.numero+" "+i.descripcion+"</p>"),n(v.val()),t();else if(0==a.code)i=findBy("elementoID",e.elemento,$elementos),notificacion("[JV] SOLICITUD ACEPTADA","SORTEO #"+e.sorteoID+"<p>GANADOR: #"+i.numero+" "+i.descripcion+"</p>");else if(4==a.code){notificacion("SORTEOS","SORTEO #"+e.sorteoID+" YA ESTA PREMIADO","growl-danger");var c=confirm("Este sorteo ya esta premiado, desea reiniciarlo?");c?socket.sendMessage("sorteo-reiniciar",{sorteoID:e.sorteoID},function(t,r){notificacion("SORTEOS","SORTEO #"+e.sorteoID+" REINICIADO SATISFACTORIAMENTE"),confirm("DESEA VOLVER A PREMIAR CON EL NUMERO SELECCIONADO?")&&s(e,o)}):o.select2("val",o.data("select"))}else 3==a.code?notificacion("SORTEOS","SORTEO #"+e.sorteoID+" PREMIADO, PERO SIN VENTAS REGISTRADAS","growl-danger"):5==a.code&&notificacion("SORTEO ABIERTO"," SORTEO #"+e.sorteoID+" AUN ESTA ABIERTO","growl-danger")})}var a,i,c,m,l,d,u,f,p,h,v=$("#sfecha"),g=new Date,O=_helpers,D=copyTo(_helpers);if($("#ord-num-num").click(function(e){e.preventDefault(e),$(".order-num").removeClass("btn btn-primary btn-sm"),$(this).addClass("btn btn-primary btn-sm"),l.n.sort(function(e,o){return e.numero-o.numero}),$("#numeros-body").html(jsrender($("#rd-vtnum-row"),l.n)),t()}),$("#ord-num-jg").click(function(e){e.preventDefault(e),$(".order-num").removeClass("btn btn-primary btn-sm"),$(this).addClass("btn btn-primary btn-sm"),l.n.sort(function(e,o){return o.jugada-e.jugada}),$("#numeros-body").html(jsrender($("#rd-vtnum-row"),l.n)),t()}),v.on("change",function(e){n(e.target.value)}),$("#monitor-form").submit(function(e){if(e.preventDefault(e),$(".canReset").html("--"),O.premio=function(e){return(100*e/d).format(2)},O.ipremio=function(e){return(100*e/f).format(2)},O.gana=function(e){return 100*e/d>100},O.pdist=function(e){return(100*e/u).format(2)},D.ganador=function(e){var o=findBy("gid",e,i);return o?"#"+o.g+" "+o.gn:""},D.iganador=function(e){var o=findBy("elementoID",e,$ielementos);return o?"#"+o.numero+" "+o.descripcion:""},a=formControls(this),a.sorteoID){$sorteos;var o=formLock(this);socket.sendMessage("monitor",a,function(e,r){function n(){socket.sendMessage("inicio",m,function(e,o){if(o.hasOwnProperty("code"));else{for(var t=0,r=0,n=0,s=0;s<o.data.length;s++)t+=o.data[s].jugado,r+=o.data[s].premio,n+=o.data[s].comision;$("#gbalance").html((t-(r+n)).format(2)),$("#gjugada").html(t.format(2)),$("#gpremios").html(r.format(2)),$("#gcomision").html(n.format(2)),$("#srt_dia").html(jsrender($("#rd-sorteos-dia-row"),o.data,D)),$("#str-dia-stamp").html(o.time),$(".num-ticketJugados").click(e=>{e.preventDefault(e);let o=$(e.target).attr("srt");alert(o)})}})}if(formLock(o,!1),null!=r.t&&null!=r.n){l=r;var s=new Date;$("#ultact").html(s.format("dd/mm/yy hh:MM:ss TT")),d=0,u=0;var c=r.t[0];r.t.forEach(function(e){d+=e.jugada,e.jugada>c.jugada&&(c=e)}),$("#jugada").html(d.format(2)),$("#bnLider").html(c.banca),$("#bnLider-jg").html(c.jugada.format(2)),c=r.n[0],r.n.forEach(function(e){u+=e.tickets,e.pcj=100*e.jugada/d,e.jugada>c.jugada&&(c=e)}),$("#numLider").html(c.desc),$("#numLider-jg").html(c.jugada.format(2)),$("#ventas-body").html(jsrender($("#rd-ventas-row"),r.t));var m={fecha:v.val(),sorteo:findBy("sorteoID",a.sorteoID,i).sorteo};socket.sendMessage("sorteo-num-hist",{srt:m.sorteo},function(e,o){var r;o.forEach(function(e){r=findBy("n",e.id,l.n),r&&(r.lastd=dayLeft(e.f)+"d",r.lastf=e.f)}),t(),n()})}else notificacion("NO HAY VENTAS REGISTRADAS PARA ESTE SORTEO")})}else notificacion("SELECCIONE UN SORTEO VALIDO")}),$("#mnt-filtrar-tickets").submit(function(e){e.preventDefault(e);var o=formControls(this);m=c.filter(function(e){return e.us==o.usuario||0==o.usuario}),m=m.filter(function(e){return e.bc==o.banca||0==o.banca}),m=m.filter(function(e){return e.tq==o.taquilla||0==o.taquilla}),$("#md-tickets-body").html(jsrender($("#rd-num-ticket"),m)),r(m)}),$("#mnt-ticket-smonto").click(function(e){function o(e,o){return 1==t?e.m-o.m:o.m-e.m}e.preventDefault(e);var t=parseInt($(this).attr("ord"));$(this).attr("ord",-1*t),m?(m.sort(o),$("#md-tickets-body").html(jsrender($("#rd-num-ticket"),m))):(c.sort(o),$("#md-tickets-body").html(jsrender($("#rd-num-ticket"),c))),r(c||m)}),$("#mnt-ticket-sticket").click(function(e){function o(e,o){return 1==t?e.id-o.id:o.id-e.id}e.preventDefault(e);var t=parseInt($(this).attr("ord"));$(this).attr("ord",-1*t),m?(m.sort(o),$("#md-tickets-body").html(jsrender($("#rd-num-ticket"),m))):(c.sort(o),$("#md-tickets-body").html(jsrender($("#rd-num-ticket"),c))),r(c||m)}),$(".mnt-filtro-tickets").change(function(){$("#mnt-filtrar-tickets").submit()}),o&&o.length>0){var I=o[0].split("-");v.datepicker("setDate",new Date(I[0],parseInt(I[1])-1,I[2])),v.trigger("change")}else n(g.format())}function reporteGeneral_nav(e,o){function t(e){var o=0,t=0,r=0;e.forEach(function(e){e.balance=e.jugada-e.premio-e.comision,o+=e.jugada,t+=e.premio,r+=e.comision}),$("#mnt-jugado").html(o.format(0)),$("#mnt-premios").html(t.format(0)),$("#mnt-comision").html(r.format(0)),$("#mnt-balance").html((o-t-r).format(0))}let r=getParameterByName("f");var n,s=$("#reporte-fecha1"),a=$("#reporte-fecha2"),i=$("#reporte");if(i.submit(function(e){e.preventDefault(e);var o=formControls(this),r=formLock(this),s=$("#rp-agrupar").val();socket.sendMessage("reporte-sorteo-global",{d:o,a:s},function(e,s){if(formLock(r,!1),!s)return $("#reporte-body").html(""),void $(".clr").html("--");n=s;var a=0,i=0,c=0,m=[],l=[];s.forEach(function(e){if(e.balance=e.jugada-e.premio-e.comision,a+=e.jugada,i+=e.premio,c+=e.comision,-1==m.indexOf(e.sorteo)){m.push(e.sorteo);var o=findBy("sorteoID",e.sorteo,$sorteos),t=exploreBy("sorteo",e.sorteo,n),r=0;t.forEach(function(e){r+=e.jugada}),o.jugada=r,o.data=t,l.push(o)}}),$("#mnt-jugado").html(a.format(0)),$("#mnt-premios").html(i.format(0)),$("#mnt-comision").html(c.format(0)),$("#mnt-balance").html((a-i-c).format(0)),$("#accordion").html(jsrenderMerge($("#rd-reporte"),l,{fechas:()=>`${o.inicio}+${o.fin}`})),$(".rptCollapse").on("shown.bs.collapse",function(){var e=parseInt($(this).attr("sorteo")),o=exploreBy("sorteo",e,n);t(o)}),$(".rptCollapse").on("hide.bs.collapse",function(){t(n)})})}),$("#rtp-desc-o").click(function(e){e.preventDefault(e),n.sort(function(e,o){var t=0;return e=e.desc.toLowerCase(),o=o.desc.toLowerCase(),e>o&&(t=1),e<o&&(t=-1),t}),$("#reporte-body").html(jsrender($("#rd-reporte"),n))}),r){r=r.split(" ");var c=r[0].split("-"),m=r[1].split("-");s.datepicker("setDate",new Date(c[0],parseInt(c[1])-1,c[2])),a.datepicker("setDate",new Date(m[0],parseInt(m[1])-1,m[2])),i.trigger("submit")}}function reporteComercial_nav(e,o){function t(e){var o=0,t=0,r=0;e.forEach(function(e){e.balance=e.jugada-e.premio-e.comision,o+=e.jugada,t+=e.premio,r+=e.comision}),$("#mnt-jugado").html(o.format(0)),$("#mnt-premios").html(t.format(0)),$("#mnt-comision").html(r.format(0)),$("#mnt-balance").html((o-t-r).format(0))}let r=getParameterByName("f");var n,s=getParameterByName("u"),a=$("#reporte-fecha1"),i=$("#reporte-fecha2"),c=$("#reporte");if(c.submit(function(e){e.preventDefault(e);var o=formControls(this),a=formLock(this);reportes("comercial",{inicio:o.inicio,fin:o.fin,comercial:s},(e,o)=>{if(o=o.d,formLock(a,!1),!o)return $("#reporte-body").html(""),void $(".clr").html("--");n=o;var s=0,i=0,c=0,m=[],l=[];o.forEach(function(e){if(e.balance=e.jugada-e.premio-e.comision,s+=e.jugada,i+=e.premio,c+=e.comision,-1==m.indexOf(e.sorteo)){m.push(e.sorteo);var o=findBy("sorteoID",e.sorteo,$sorteos),t=exploreBy("sorteo",e.sorteo,n),r=0;t.forEach(function(e){r+=e.jugada}),o.jugada=r,o.data=t,l.push(o)}}),$("#mnt-jugado").html(s.format(0)),$("#mnt-premios").html(i.format(0)),$("#mnt-comision").html(c.format(0)),$("#mnt-balance").html((s-i-c).format(0)),$("#accordion").html(jsrenderMerge($("#rd-reporte"),l,{fechas:()=>r})),$(".rptCollapse").on("shown.bs.collapse",function(){var e=parseInt($(this).attr("sorteo")),o=exploreBy("sorteo",e,n);t(o)}),$(".rptCollapse").on("hide.bs.collapse",function(){t(n)})})}),$("#rtp-desc-o").click(function(e){e.preventDefault(e),n.sort(function(e,o){var t=0;return e=e.desc.toLowerCase(),o=o.desc.toLowerCase(),e>o&&(t=1),e<o&&(t=-1),t}),$("#reporte-body").html(jsrender($("#rd-reporte"),n))}),r){var m=r.split(" ")[0].split("-"),l=r.split(" ")[1].split("-");a.datepicker("setDate",new Date(m[0],parseInt(m[1])-1,m[2])),i.datepicker("setDate",new Date(l[0],parseInt(l[1])-1,l[2])),c.trigger("submit")}}function reporteUsuario_nav(e,o){function t(e){var o=0,t=0,r=0;e.forEach(function(e){e.balance=e.jugada-e.premio-e.comision,o+=e.jugada,t+=e.premio,r+=e.comision}),$("#mnt-jugado").html(o.format(0)),$("#mnt-premios").html(t.format(0)),$("#mnt-comision").html(r.format(0)),$("#mnt-balance").html((o-t-r).format(0))}let r=getParameterByName("f");var n,s=getParameterByName("u"),a=$("#reporte-fecha1"),i=$("#reporte-fecha2"),c=$("#reporte");if(c.submit(function(e){e.preventDefault(e);var o=formControls(this),a=formLock(this);reportes("usuario",{inicio:o.inicio,fin:o.fin,usuario:s},(e,o)=>{if(o=o.d,formLock(a,!1),!o)return $("#reporte-body").html(""),void $(".clr").html("--");n=o;var s=0,i=0,c=0,m=[],l=[];o.forEach(function(e){if(e.balance=e.jugada-e.premio-e.comision,s+=e.jugada,i+=e.premio,c+=e.comision,-1==m.indexOf(e.sorteo)){m.push(e.sorteo);var o=findBy("sorteoID",e.sorteo,$sorteos),t=exploreBy("sorteo",e.sorteo,n),r=0;t.forEach(function(e){r+=e.jugada}),o.jugada=r,o.data=t,l.push(o)}}),$("#mnt-jugado").html(s.format(0)),$("#mnt-premios").html(i.format(0)),$("#mnt-comision").html(c.format(0)),$("#mnt-balance").html((s-i-c).format(0)),$("#accordion").html(jsrenderMerge($("#rd-reporte"),l,{fechas:()=>r})),$(".rptCollapse").on("shown.bs.collapse",function(){var e=parseInt($(this).attr("sorteo")),o=exploreBy("sorteo",e,n);t(o)}),$(".rptCollapse").on("hide.bs.collapse",function(){t(n)})})}),$("#rtp-desc-o").click(function(e){e.preventDefault(e),n.sort(function(e,o){var t=0;return e=e.desc.toLowerCase(),o=o.desc.toLowerCase(),e>o&&(t=1),e<o&&(t=-1),t}),$("#reporte-body").html(jsrender($("#rd-reporte"),n))}),r){var m=r.split(" ")[0].split("-"),l=r.split(" ")[1].split("-");a.datepicker("setDate",new Date(m[0],parseInt(m[1])-1,m[2])),i.datepicker("setDate",new Date(l[0],parseInt(l[1])-1,l[2])),c.trigger("submit")}}function sorteosUsuarios_nav(e,o){function t(e,o){r=o,$("#ubody").html(jsrender($("#usuario-row"),o)),$(".usuario-rem").click(function(e){var o=$(this).data("id");socket.sendMessage("sorteo-usuario",{sid:o},function(e,n){if(1==n.code){notificacion("USUARIO REMOVIDO CON EXITO");var s=findIndex("sID",o,r);s>-1&&(r.splice(s,1),t("sorteos-usuarios",r))}else notificacion("ERROR AL REMOVER USUARIO",null,"text-growl-danger")})})}var r;socket.sendMessage("sorteos-usuarios",null,t),$("#reg-usuario").submit(function(e){e.preventDefault(e);var o=formControls(this),r=formLock(this);socket.sendMessage("sorteo-usuario",o,function(e,o){formReset(r),1==o.code?socket.sendMessage("sorteos-usuarios",null,t):notificacion("ERROR AL REGISTRAR USUARIO","Usuario no existe")})})}function dayLeft(e){var o=(new Date).format().split("-"),t=new Date(o[0],o[1]-1,o[2]),r=e.split("-"),n=new Date(r[0],r[1]-1,r[2]);return Math.round((t.getTime()-n.getTime())/864e5,0)}function reportes(e,o,t){let r=reportesMap[e](o);socket.sendMessage("sql-command",{sql:r},(e,o)=>t(e,o))}nav.paginas.addListener(Navegador.ENTER,function(e,o){var t=jQuery(".mainpanel"),r=jQuery(document).height(),n=t.height();r>n&&t.height(r),$(".date").datepicker({dateFormat:"yy-mm-dd"}),$(".now").datepicker("setDate",new Date),$(".s2-elementos").html(jsrender($("#rd-elemento-option"),$elementos))}),nav.paginas.addListener(Navegador.COMPLETE,function(e,o){select2w($(".s2"),{allowClear:!0,minimumResultsForSearch:5}),jQuery(".minimize").click(function(){var e=jQuery(this),o=e.closest(".panel");return jQuery(this).hasClass("maximize")?(o.find(".panel-body, .panel-footer").slideDown(200),e.removeClass("maximize"),e.html("&minus;")):(o.find(".panel-body, .panel-footer").slideUp(200),e.addClass("maximize"),e.html("&plus;")),!1}),$(".toLower").change(function(e){var o=$(e.target);o.val(o.val().toLowerCase())})}),nav.paginas.addListener("login",login_nav),nav.paginas.addListener("inicio",inicio_nav),nav.paginas.addListener("sorteos/buscar",sorteoBuscar_nav),nav.paginas.addListener("sorteos/premiar",sorteoPremiar_nav),nav.paginas.addListener("monitor",sorteoMonitor_nav),nav.paginas.addListener("reporte/general",reporteGeneral_nav),nav.paginas.addListener("reporte/comercial",reporteComercial_nav),nav.paginas.addListener("reporte/usuario",reporteUsuario_nav),nav.paginas.addListener("sorteos/usuarios",sorteosUsuarios_nav),nav.paginas.addListener("sorteos/pendientes",function(e,o){var t={padding:padding,sorteos:function(e){for(var o="",t=exploreBy("sorteo",e,$elementos),r=0;r<t.length;r++)o+='<option value="'+t[r].elementoID+'">#'+t[r].numero+" "+t[r].descripcion+"</option>";return o}};$("#sorteo-buscar").submit(function(e){function o(){$("#accordion").html(jsrender($("#rd-sorteo-row"),s,t)),select2w($(".s3"),{allowClear:!0}),$("select.sorteosel").each(function(e,o){var t=$(o).data("select");$(o).val(t),$(o).select2("val",t)}),$(".sorteosel").change(function(e){var o=e.target.value,t=$(this),n=t.data("sorteo"),s=findBy("elementoID",o,$elementos),i=findBy("sorteoID",n,a),c=confirm("Confirma que desea registrar #"+i.sorteoID+" "+i.descripcion+" #"+s.numero+" "+s.descripcion);if(c){var m={sorteoID:n,elemento:o};r(m,t)}else t.select2("val",t.data("select")),t.val(t.data("select"))})}function r(e,o){socket.sendMessage("sorteo-premiar",e,function(t,n){var s;if(1==n.code)s=findBy("elementoID",e.elemento,$elementos),notificacion("SORTEO PREMIADO","SORTEO #"+e.sorteoID+" PREMIADO<p>GANADOR: #"+s.numero+" "+s.descripcion+"</p>");else if(0==n.code)s=findBy("elementoID",e.elemento,$elementos),notificacion("[JV] SOLICITUD ACEPTADA","SORTEO #"+e.sorteoID+"<p>GANADOR: #"+s.numero+" "+s.descripcion+"</p>");else if(4==n.code){notificacion("SORTEOS","SORTEO #"+e.sorteoID+" YA ESTA PREMIADO","growl-danger");var a=confirm("Este sorteo ya esta premiado, desea reiniciarlo");a?socket.sendMessage("sorteo-reiniciar",{sorteoID:e.sorteoID},function(t,n){notificacion("SORTEOS","SORTEO #"+e.sorteoID+" REINICIADO SATISFACTORIAMENTE"),confirm("DESEA VOLVER A PREMIAR CON EL NUMERO SELECCIONADO?")&&r(e,o)}):(o.select2("val",o.data("select")),o.val(o.data("select")))}else 3==n.code?notificacion("SORTEOS","SORTEO #"+e.sorteoID+" PREMIADO, PERO SIN VENTAS REGISTRADAS","growl-danger"):5==n.code&&notificacion("SORTEO ABIERTO"," SORTEO #"+e.sorteoID+" AUN ESTA ABIERTO","growl-danger")})}e.preventDefault(e);var n,s,a,i=formControls(this),c=formLock(this);socket.sendMessage("sorteo-pendientes",i,function(e,t){if(formLock(c,!1),t&&0!=t.length){a=t,n=[],s=[];for(var r=0;r<t.length;r++){var i=n.indexOf(t[r].sorteo);if(-1==i)n.push(t[r].sorteo),s.push({descripcion:findBy("sorteoID",t[r].sorteo,$sorteos).nombre,sorteo:t[r].sorteo,horarios:[t[r]]});else{var m=s[i];m.horarios.push(t[r])}}if($elementos&&$elementos.length>0)o();else{function l(e,t){"end"==t?o():$elementos=$elementos.concat(t)}socket.addListener("elementos",l),socket.sendMessage("elementos",{sorteos:n})}}})})}),nav.paginas.addListener("historia",function(e,o){socket.sendMessage("lsorteos",null,(e,o)=>{$("#sorteos").html(jsrender($("#rd-sorteo-option"),o))}),$("#historiaForm").submit(function(e){e.preventDefault();let o=formControls(this);socket.sendMessage("sorteo-num-hist",o,(e,o)=>{o=o.sort((e,o)=>e.id-o.id),o.forEach(e=>{e.ultimo=dayLeft(e.f)}),$("#historiaTable").html(jsrender($("#rd-sorteo-row"),o))})})});let reportesMap={comercial:({comercial:e,inicio:o,fin:t})=>`SELECT sorteos.sorteo, usuarios.usuarioId cid, usuarios.nombre desc, SUM(reportes.jugada) jugada, SUM(reportes.premio) premio, ROUND(SUM(jugada*reportes.comision*0.01),0) comision \n        FROM reportes\n          JOIN vt.sorteos ON sorteos.sorteoID = reportes.sorteoID \n          JOIN us.bancas ON bancas.bancaID = reportes.bancaID \n          JOIN us.usuarios ON usuarios.usuarioID = bancas.usuarioID\n          JOIN us.comer_usuario ON comer_usuario.uid = bancas.usuarioID\n          WHERE \n          comer_usuario.cID = ${e} AND\n          sorteos.sorteo IN (SELECT sorteoID  FROM admins_meta JOIN main.sorteos ON admins_meta.valor = sorteos.sorteoID WHERE adminID = ${$usuario.adminID})\n          AND reportes.fecha BETWEEN "${o}" AND "${t}"\n          GROUP BY sorteos.sorteo, usuarios.usuarioID\n          ORDER BY sorteos.sorteo`.split("\n").join(""),usuario:({usuario:e,inicio:o,fin:t})=>`SELECT sorteos.sorteo, usuarios.usuarioId cid, bancas.nombre desc, SUM(reportes.jugada) jugada, SUM(reportes.premio) premio, ROUND(SUM(jugada*reportes.comision*0.01),0) comision \n    FROM reportes\n      JOIN vt.sorteos ON sorteos.sorteoID = reportes.sorteoID \n      JOIN us.bancas ON bancas.bancaID = reportes.bancaID \n      JOIN us.usuarios ON usuarios.usuarioID = bancas.usuarioID\n      JOIN us.comer_usuario ON comer_usuario.uid = bancas.usuarioID\n      WHERE \n      usuarios.usuarioID = ${e} AND\n      sorteos.sorteo IN (SELECT sorteoID  FROM admins_meta JOIN main.sorteos ON admins_meta.valor = sorteos.sorteoID WHERE adminID = ${$usuario.adminID})\n      AND reportes.fecha BETWEEN "${o}" AND "${t}"\n      GROUP BY sorteos.sorteo, bancas.bancaID\n      ORDER BY sorteos.sorteo`.split("\n").join("")};